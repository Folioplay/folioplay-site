{"version":3,"sources":["../../src/baseEvmAdapter.ts","../../src/ObservableStore.ts","../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js","../node_modules/.pnpm/is-stream@2.0.1/node_modules/is-stream/index.js","../../src/interfaces.ts","../../src/supportedCurrencies.ts","../../src/config.ts","../../src/embedUtils.ts","../../src/loglevel.ts","../../src/messages.ts","../../src/utils.ts","../../src/inpage-provider.ts","../../src/integrity.ts","../../src/PopupHandler.ts","../../src/siteMetadata.ts","../../src/embed.ts","../node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/objectWithoutProperties.js","../node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js","../../src/index.ts","../../src/asStream.ts","../../src/ComposedStore.ts","../../src/MergedStore.ts","../../src/transform.ts","../node_modules/.pnpm/through2@2.0.5/node_modules/through2/through2.js","../../src/torusWalletAdapter.ts"],"names":["BaseEvmAdapter","params","clientId","provider","chainConfig","chainId","WalletLoginError","notConnectedError","chainNamespace","status","ADAPTER_STATUS","CONNECTED","request","method","accounts","length","existingToken","getSavedToken","name","checkIfTokenIsExpired","idToken","payload","domain","window","location","origin","uri","href","address","parseInt","version","nonce","Math","random","toString","slice","issuedAt","Date","toISOString","signChallenge","challenge","signedMessage","verifySignedChallenge","sessionTime","saveToken","disconnectionError","clearToken","BaseAdapter","ObservableStore","initState","_state","this","_getState","newState","_putState","emit","partialState","state","getState","putState","handler","on","removeListener","module","exports","equal","a","b","constructor","i","keys","Array","isArray","RegExp","source","flags","valueOf","Object","prototype","hasOwnProperty","call","key","isStream","stream","pipe","writable","_write","_writableState","readable","_read","_readableState","duplex","transform","_transform","LOGIN_PROVIDER","WALLET_VERIFIERS","GOOGLE","FACEBOOK","TWITCH","REDDIT","DISCORD","EMAIL_PASSWORDLESS","WALLET_OPENLOGIN_VERIFIER_MAP","PAYMENT_PROVIDER","SUPPORTED_PAYMENT_NETWORK","TORUS_BUILD_ENV","BUTTON_POSITION","PROVIDER_SUPPORTED_FIAT_CURRENCIES","cryptoCompareCurrenciesSet","Set","supportedFiatCurrencies","filter","currency","has","providerSupportedFiatCurrencies","paymentProviders","line1","line2","line3","supportPage","minOrderValue","maxOrderValue","validCurrencies","validCryptoCurrenciesByChain","value","display","includeFees","api","enforceMax","receiveHint","sell","supportedVerifierList","values","translations","en","embed","continue","actionRequired","pendingAction","cookiesRequired","enableCookies","clickHere","de","ja","ko","zh","prodTorusUrl","localStorageKeyPrefix","runOnLoad","fn","Promise","resolve","reject","document","body","then","catch","addEventListener","htmlToElement","html","template","createElement","trimmedHtml","trim","innerHTML","content","firstChild","handleEvent","handle","eventName","handlerArgs","handlerWrapper","removeEventListener","handleStream","chunk","documentReady","readyState","loglevel","getLogger","errors","disconnected","permanentlyDisconnected","sendSiteMetadata","unsupportedSync","invalidDuplexStream","invalidOptions","maxEventListeners","shouldSendMetadata","invalidRequestArgs","invalidRequestMethod","invalidRequestParams","invalidLoggerObject","invalidLoggerMethod","info","connected","warnings","enableDeprecation","sendDeprecation","events","close","data","networkChanged","notification","publicConfigStore","config","createErrorMiddleware","req","res","next","error","rpc","invalidRequest","message","done","log","logStreamDisconnectWarning","remoteLabel","emitter","warningMsg","stack","warn","listenerCount","getPreopenInstanceId","getTorusUrl","buildEnv","integrity","versionUsed","get","useAPIKey","response","logLevel","torusUrl","getUserLanguage","userLanguage","navigator","language","userLanguages","split","EMITTED_NOTIFICATIONS","NOOP","FEATURES_PROVIDER_CHANGE_WINDOW","FEATURES_DEFAULT_WALLET_WINDOW","FEATURES_CONFIRM_WINDOW","SafeEventEmitter","defaultMaxListeners","getRpcPromiseCallback","unwrapResult","result","TorusInpageProvider","connectionStream","jsonRpcStreamName","enable","experimentalMethods","send","isDuplexStream","Error","messages","isTorus","setMaxListeners","_defaultState","selectedAddress","networkVersion","_handleAccountsChanged","bind","_handleChainChanged","_handleUnlockStateChanged","_handleConnect","_handleDisconnect","_handleStreamDisconnect","_sendSync","_rpcRequest","_warnOfDeprecation","_initializeState","sendAsync","mux","ObjectMultiplex","pump","_publicConfigStore","storageKey","createStream","storeAsStream","ignoreStream","isConnected","jsonRpcConnection","createStreamMiddleware","rpcEngine","JRPCEngine","push","createIdRemapMiddleware","middleware","_rpcEngine","includes","type","_sentWarnings","args","undefined","callback","addListener","listener","once","prependListener","prependOnceListener","isUnlocked","initialized","isInternal","cb","_payload","jsonrpc","err","tryPreopenHandle","methodOrPayload","callbackOrArgs","id","debug","isRecoverable","errorMessage","isPermanentlyDisconnected","EthereumRpcError","streamName","isEthAccounts","finalAccounts","account","dequal","hasEmittedConnection","hashes","options","internalHashes","algorithms","forEach","algorithm","createHash","update","digest","main","finalOptions","delimiter","full","defaults","sri","output","map","join","PopupHandler","url","target","features","dualScreenLeft","screenLeft","screenX","dualScreenTop","screenTop","screenY","width","innerWidth","documentElement","clientWidth","screen","height","innerHeight","clientHeight","left","abs","top","w","getPopupFeatures","windowTimer","iClosedWindow","_setupTimer","Number","setInterval","closed","clearInterval","open","focus","redirect","locationReplaceOnRedirect","replace","EventEmitter","imgExists","img","onload","onerror","src","e","getSiteName","siteName","querySelector","metaTitle","title","hostname","getSiteIcon","icon","from","querySelectorAll","find","_icon","Boolean","getSiteMetadata","engine","domainMetadata","originalError","defaultVerifiers","iframeIntegrity","expectedCacheControlHeader","UNSAFE_METHODS","torusIframeHtml","check","hash","crossOrigin","rel","relList","supports","head","appendChild","Torus","buttonPosition","buttonSize","modalZIndex","apiKey","configuration","isLoggedIn","isInitialized","torusWidgetVisibility","requestedVerifier","currentVerifier","setAPIKey","alertZIndex","isIframeFullScreen","init","enableLogging","enabledVerifiers","network","host","networkName","blockExplorer","ticker","tickerName","loginConfig","showTorusButton","whiteLabel","skipTKey","useWalletConnect","mfaLevel","isCustomLogin","setDefaultLevel","enableAll","disableAll","torusIframeUrl","URL","pathname","endsWith","torusIframe","torusAlertContainer","style","setProperty","link","setAttribute","styleLink","defaultLanguage","customTranslations","mergedTranslations","deepmerge","languageTranslations","embedTranslations","handleSetup","_setupWeb3","initStream","communicationMux","getStream","success","_displayIframe","write","fetchUrl","fetch","cache","resp","headers","text","calculatedIntegrity","generateIntegrity","clearInit","login","verifier","login_hint","loginHint","ethereum","logout","statusStream","loggedIn","cleanUp","isElement","element","Element","HTMLDocument","contains","remove","torusAlert","hideTorusButton","_sendWidgetVisibilityStatus","setProvider","rest","providerChangeStream","preopenInstanceId","_handleWindow","override","showWallet","path","showWalletStream","finalPath","showWalletHandler","instanceId","finalUrl","searchParams","append","x","getPublicAddress","verifierId","isExtended","walletVerifier","openloginVerifier","getUserInfo","userInfoAccessStream","approved","rejected","newRequest","userInfoStream","handlerChunk","initiateTopup","isValid","selectedProvider","selectedParams","fiatValue","requestedOrderAmount","parseFloat","selectedCurrency","selectedCryptoCurrency","flat","finalCryptoCurrency","toLowerCase","validatePaymentProvider","JSON","stringify","topupStream","loginWithPrivateKey","loginParams","userInfo","privateKey","Buffer","loginPrivKeyStream","showWalletConnectScanner","walletConnectStream","windowStream","handledWindow","_createPopupBlockAlert","closeHandler","receivedId","_setEmbedWhiteLabel","theme","isDark","colors","classList","add","torusBrand1","torusGray2","_getLogoUrl","logoUrl","logoLight","logoDark","isFull","size","right","bottom","assign","metamaskStream","BasePostMessageStream","targetWindow","contentWindow","targetOrigin","communicationStream","inpageProvider","detectAccountRequestPrototypeModifier","m","originalMethod","apply","setTimeout","handleLoginCb","_","_showLoginPopup","isLoginCallback","proxiedInpageProvider","Proxy","deleteProperty","setupMultiplex","calledFromEmbed","loginHandler","oauthStream","successAlert","btnContainer","children","objectWithoutPropertiesLoose","excluded","getOwnPropertySymbols","sourceSymbolKeys","indexOf","propertyIsEnumerable","__esModule","sourceKeys","ObservableStoreStream","obsStore","objectMode","resume","subscribe","dest","_encoding","_size","unsubscribe","Duplex","ComposedStore","_children","childKey","child","_addChild","updateFromChild","childValue","MergedStore","_updateWholeState","childStates","syncTransformFn","Transform","require","inherits","xtend","DestroyableTransform","opts","_destroyed","noop","enc","through2","construct","flush","destroy","self","process","nextTick","t2","_flush","ctor","Through2","obj","highWaterMark","TorusWalletAdapter","_this","WALLET_ADAPTERS","TORUS_EVM","ADAPTER_NAMESPACES","EIP155","CHAIN_NAMESPACES","ADAPTER_CATEGORY","EXTERNAL","NOT_READY","torusWalletOptions","adapterSettings","initParams","loginSettings","torusInstance","displayName","rpcTarget","getChainConfig","READY","ADAPTER_EVENTS","autoConnect","rehydrated","connect","ERRORED","WalletInitializationError","notReady","CONNECTING","adapter","_chainId","updatedChainID","fromCode","reconnected","Web3AuthError","connectionError","cleanup","DISCONNECTED"],"mappings":"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A,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,QA9CuC,cAoDxCA,EAAwB,CACvB,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,QAhFuC,cAmFxCA,EAA+B,CAAC,MAAO,MAAO,QAnFN,cAqFxCA,GAA2B,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,QArFnD,cAwFxCA,GAA4B,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,QAxFpD,cA8FxCA,GAA2B,CAC1B,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,QA1IuC,cA4IxCA,GAAyB,CAAC,MAAO,MAAO,QAAf,GAGtBK,GAA6B,IAAIC,IAhbE,CACvC,MACA,OACA,OACA,OACA,QACA,MACA,MACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,QACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,SACA,QACA,MACA,MACA,SACA,KACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,MACA,MACA,OACA,MACA,OACA,MACA,MACA,KACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,MACA,MACA,MACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,MACA,OACA,MACA,MACA,OACA,OACA,OACA,MACA,MACA,MACA,WACA,OACA,MACA,MACA,UACA,SACA,MACA,SACA,OACA,OACA,QACA,MACA,MACA,MACA,MACA,OACA,MACA,OACA,MACA,MACA,MACA,QACA,MACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,MACA,QACA,MACA,MACA,MACA,QACA,MACA,OACA,MACA,OACA,OACA,OACA,OACA,OACA,QACA,OACA,OACA,OACA,MACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,OACA,OACA,OACA,MACA,OACA,QACA,QACA,MACA,MACA,MACA,MACA,QACA,OACA,QA0JI,SAAUC,GAAwB3G,GAEtC,OADwCwG,GAAmCxG,GACpC4G,QAAQC,YAAD,OAAcJ,GAA2BK,IAAID,EAApFE,GACR,CC5bD,IAAMC,IAAgB,mBACnBZ,EAA2B,CAC1Ba,MAAO,gCACPC,MAAO,gBACPC,MAAO,mCACP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","file":"static/js/7.54fdbc90.chunk.js","sourcesContent":["import _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { WalletLoginError, saveToken, verifySignedChallenge, signChallenge, getSavedToken, checkIfTokenIsExpired, ADAPTER_STATUS, clearToken, BaseAdapter } from '@web3auth/base';\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar BaseEvmAdapter = /*#__PURE__*/function (_BaseAdapter) {\n  _inherits(BaseEvmAdapter, _BaseAdapter);\n\n  var _super = _createSuper(BaseEvmAdapter);\n\n  function BaseEvmAdapter() {\n    var _this;\n\n    var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, BaseEvmAdapter);\n\n    _this = _super.call(this);\n\n    _defineProperty(_assertThisInitialized(_this), \"clientId\", void 0);\n\n    _this.clientId = params.clientId;\n    return _this;\n  }\n\n  _createClass(BaseEvmAdapter, [{\n    key: \"authenticateUser\",\n    value: function () {\n      var _authenticateUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this$chainConfig;\n\n        var _this$chainConfig2, chainNamespace, chainId, accounts, existingToken, isExpired, payload, challenge, signedMessage, idToken;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(!this.provider || !((_this$chainConfig = this.chainConfig) !== null && _this$chainConfig !== void 0 && _this$chainConfig.chainId))) {\n                  _context.next = 2;\n                  break;\n                }\n\n                throw WalletLoginError.notConnectedError();\n\n              case 2:\n                _this$chainConfig2 = this.chainConfig, chainNamespace = _this$chainConfig2.chainNamespace, chainId = _this$chainConfig2.chainId;\n\n                if (!(this.status !== ADAPTER_STATUS.CONNECTED)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                throw WalletLoginError.notConnectedError(\"Not connected with wallet, Please login/connect first\");\n\n              case 5:\n                _context.next = 7;\n                return this.provider.request({\n                  method: \"eth_accounts\"\n                });\n\n              case 7:\n                accounts = _context.sent;\n\n                if (!(accounts && accounts.length > 0)) {\n                  _context.next = 26;\n                  break;\n                }\n\n                existingToken = getSavedToken(accounts[0], this.name);\n\n                if (!existingToken) {\n                  _context.next = 14;\n                  break;\n                }\n\n                isExpired = checkIfTokenIsExpired(existingToken);\n\n                if (isExpired) {\n                  _context.next = 14;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", {\n                  idToken: existingToken\n                });\n\n              case 14:\n                payload = {\n                  domain: window.location.origin,\n                  uri: window.location.href,\n                  address: accounts[0],\n                  chainId: parseInt(chainId, 16),\n                  version: \"1\",\n                  nonce: Math.random().toString(36).slice(2),\n                  issuedAt: new Date().toISOString()\n                };\n                _context.next = 17;\n                return signChallenge(payload, chainNamespace);\n\n              case 17:\n                challenge = _context.sent;\n                _context.next = 20;\n                return this.provider.request({\n                  method: \"personal_sign\",\n                  params: [challenge, accounts[0]]\n                });\n\n              case 20:\n                signedMessage = _context.sent;\n                _context.next = 23;\n                return verifySignedChallenge(chainNamespace, signedMessage, challenge, this.name, this.sessionTime, this.clientId);\n\n              case 23:\n                idToken = _context.sent;\n                saveToken(accounts[0], this.name, idToken);\n                return _context.abrupt(\"return\", {\n                  idToken: idToken\n                });\n\n              case 26:\n                throw WalletLoginError.notConnectedError(\"Not connected with wallet, Please login/connect first\");\n\n              case 27:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function authenticateUser() {\n        return _authenticateUser.apply(this, arguments);\n      }\n\n      return authenticateUser;\n    }()\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var accounts;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(this.status !== ADAPTER_STATUS.CONNECTED)) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                throw WalletLoginError.disconnectionError(\"Not connected with wallet\");\n\n              case 2:\n                _context2.next = 4;\n                return this.provider.request({\n                  method: \"eth_accounts\"\n                });\n\n              case 4:\n                accounts = _context2.sent;\n\n                if (accounts && accounts.length > 0) {\n                  clearToken(accounts[0], this.name);\n                }\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function disconnect() {\n        return _disconnect.apply(this, arguments);\n      }\n\n      return disconnect;\n    }()\n  }]);\n\n  return BaseEvmAdapter;\n}(BaseAdapter);\n\nexport { BaseEvmAdapter };\n//# sourceMappingURL=baseEvmAdapter.esm.js.map\n","import SafeEventEmitter from '@metamask/safe-event-emitter';\n\nexport class ObservableStore<T> extends SafeEventEmitter {\n  private _state: T;\n\n  constructor(initState: T) {\n    super();\n    if (initState) {\n      this._state = initState;\n    } else {\n      // Typecast/default state: Preserve existing behavior\n      this._state = {} as unknown as T;\n    }\n  }\n\n  // wrapper around internal getState\n  getState(): T {\n    return this._getState();\n  }\n\n  // wrapper around internal putState\n  putState(newState: T): void {\n    this._putState(newState);\n    this.emit('update', newState);\n  }\n\n  updateState(partialState: Partial<T>): void {\n    // if non-null object, merge\n    if (partialState && typeof partialState === 'object') {\n      const state = this.getState();\n      this.putState({ ...state, ...partialState });\n      // if not object, use new value\n    } else {\n      this.putState(partialState);\n    }\n  }\n\n  // subscribe to changes\n  subscribe(handler: (state: T) => void): void {\n    this.on('update', handler);\n  }\n\n  // unsubscribe to changes\n  unsubscribe(handler: (state: T) => void): void {\n    this.removeListener('update', handler);\n  }\n\n  //\n  // private\n  //\n\n  // read from persistence\n  protected _getState(): T {\n    return this._state;\n  }\n\n  // write to persistence\n  protected _putState(newState: T): void {\n    this._state = newState;\n  }\n}\n","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","'use strict';\n\nconst isStream = stream =>\n\tstream !== null &&\n\ttypeof stream === 'object' &&\n\ttypeof stream.pipe === 'function';\n\nisStream.writable = stream =>\n\tisStream(stream) &&\n\tstream.writable !== false &&\n\ttypeof stream._write === 'function' &&\n\ttypeof stream._writableState === 'object';\n\nisStream.readable = stream =>\n\tisStream(stream) &&\n\tstream.readable !== false &&\n\ttypeof stream._read === 'function' &&\n\ttypeof stream._readableState === 'object';\n\nisStream.duplex = stream =>\n\tisStream.writable(stream) &&\n\tisStream.readable(stream);\n\nisStream.transform = stream =>\n\tisStream.duplex(stream) &&\n\ttypeof stream._transform === 'function';\n\nmodule.exports = isStream;\n","import _objectWithoutProperties from '@babel/runtime/helpers/objectWithoutProperties';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { get, setAPIKey } from '@toruslabs/http-helpers';\nimport { SafeEventEmitter, ObjectMultiplex, createStreamMiddleware, JRPCEngine, createIdRemapMiddleware, BasePostMessageStream, setupMultiplex } from '@toruslabs/openlogin-jrpc';\nimport deepmerge from 'lodash.merge';\nimport { ObservableStore, storeAsStream } from '@metamask/obs-store';\nimport { ethErrors, EthereumRpcError } from 'eth-rpc-errors';\nimport dequal from 'fast-deep-equal';\nimport { duplex } from 'is-stream';\nimport pump from 'pump';\nimport loglevel from 'loglevel';\nimport createHash from 'create-hash';\nimport { EventEmitter } from 'events';\n\nconst LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  TWITCH: \"twitch\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\"\n};\nconst WALLET_VERIFIERS = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  TWITCH: \"twitch\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n  EMAIL_PASSWORDLESS: \"torus-auth0-email-passwordless\"\n};\nconst WALLET_OPENLOGIN_VERIFIER_MAP = {\n  [WALLET_VERIFIERS.GOOGLE]: \"tkey-google\",\n  [WALLET_VERIFIERS.FACEBOOK]: \"tkey-facebook\",\n  [WALLET_VERIFIERS.TWITCH]: \"tkey-twitch\",\n  [WALLET_VERIFIERS.REDDIT]: \"tkey-reddit\",\n  [WALLET_VERIFIERS.DISCORD]: \"tkey-discord\",\n  [WALLET_VERIFIERS.EMAIL_PASSWORDLESS]: \"tkey-auth0-email-passwordless\"\n};\nconst PAYMENT_PROVIDER = {\n  MOONPAY: \"moonpay\",\n  WYRE: \"wyre\",\n  RAMPNETWORK: \"rampnetwork\",\n  XANPOOL: \"xanpool\",\n  MERCURYO: \"mercuryo\",\n  TRANSAK: \"transak\",\n  BANXA: \"banxa\"\n};\nconst SUPPORTED_PAYMENT_NETWORK = {\n  MAINNET: \"mainnet\",\n  MATIC: \"matic\",\n  BSC_MAINNET: \"bsc_mainnet\",\n  AVALANCHE_MAINNET: \"avalanche_mainnet\",\n  XDAI: \"xdai\"\n};\nconst TORUS_BUILD_ENV = {\n  PRODUCTION: \"production\",\n  DEVELOPMENT: \"development\",\n  BINANCE: \"binance\",\n  TESTING: \"testing\",\n  LRC: \"lrc\",\n  BETA: \"beta\",\n  BNB: \"bnb\",\n  POLYGON: \"polygon\"\n};\nconst BUTTON_POSITION = {\n  BOTTOM_LEFT: \"bottom-left\",\n  TOP_LEFT: \"top-left\",\n  BOTTOM_RIGHT: \"bottom-right\",\n  TOP_RIGHT: \"top-right\"\n};\n\n/**\n * From https://min-api.cryptocompare.com/data/v2/pair/mapping/fsym?fsym=BTC&extraParams=YourSite\n * GET https://min-api.cryptocompare.com/data/v2/pair/mapping/fsym?fsym=BTC\n * Then map over returned entries, picking tsym\n *\n * Last updated: Date of commit\n */\n\nconst CRYPTO_COMPARE_CURRENCIES = [\"ETH\", \"USDT\", \"USDC\", \"TUSD\", \"EOSDT\", \"USD\", \"DAI\", \"GUSD\", \"DKKT\", \"PAX\", \"ILS\", \"RUB\", \"BYN\", \"EUR\", \"GBP\", \"JPY\", \"KRW\", \"PLN\", \"MXN\", \"AUD\", \"BRL\", \"CAD\", \"CHF\", \"KPW\", \"LAK\", \"LBP\", \"LKR\", \"XOF\", \"CNHT\", \"DOGE\", \"UAH\", \"TRY\", \"HKD\", \"XJP\", \"SGD\", \"USC\", \"NZD\", \"NGN\", \"RUR\", \"COP\", \"GHS\", \"EGP\", \"IDR\", \"BHD\", \"CRC\", \"PEN\", \"AED\", \"DOP\", \"PKR\", \"HUF\", \"VND\", \"XAR\", \"LTC\", \"RON\", \"OMR\", \"MYR\", \"DKK\", \"UGX\", \"ZMW\", \"SAR\", \"SEK\", \"GEL\", \"RWF\", \"IRR\", \"TZS\", \"CNY\", \"VEF\", \"BDT\", \"HRK\", \"CLP\", \"THB\", \"XAF\", \"ARS\", \"UYU\", \"SZL\", \"KZT\", \"NOK\", \"KES\", \"PAB\", \"INR\", \"CZK\", \"MAD\", \"TWD\", \"PHP\", \"ZAR\", \"BOB\", \"CDF\", \"DASH\", \"VES\", \"ISK\", \"MWK\", \"BAM\", \"TTD\", \"XRP\", \"JOD\", \"RSD\", \"HNL\", \"BGN\", \"GTQ\", \"BWP\", \"XMR\", \"MMK\", \"QAR\", \"AOA\", \"KWD\", \"MUR\", \"WUSD\", \"WEUR\", \"WAVES\", \"WTRY\", \"LRD\", \"LSL\", \"LYD\", \"AWG\", \"MDL\", \"BTO\", \"EURS\", \"CHFT\", \"MKD\", \"MNT\", \"MOP\", \"MRO\", \"MVR\", \"VOLLAR\", \"CKUSD\", \"KHR\", \"VUV\", \"BITCNY\", \"QC\", \"BBD\", \"NAD\", \"NPR\", \"PGK\", \"PYG\", \"BIF\", \"BMD\", \"BND\", \"XLM\", \"BNB\", \"SCR\", \"BAT\", \"CRO\", \"HT\", \"KCS\", \"LEO\", \"LINK\", \"MKR\", \"NPXS\", \"OMG\", \"REP\", \"ZB\", \"ZIL\", \"ZRX\", \"BCH\", \"BZD\", \"CUP\", \"CVE\", \"DJF\", \"DZD\", \"ERN\", \"ETB\", \"FJD\", \"FKP\", \"BUSD\", \"ANCT\", \"ALL\", \"AMD\", \"ANG\", \"CNYX\", \"IQD\", \"UZS\", \"TND\", \"GGP\", \"XAU\", \"KGS\", \"GIP\", \"JMD\", \"ZEC\", \"USDP\", \"BSV\", \"EMC2\", \"SNT\", \"GTO\", \"POWR\", \"EUSD\", \"EURT\", \"BCY\", \"BTS\", \"ATM\", \"BLOCKPAY\", \"ARDR\", \"AMP\", \"B2X\", \"BITGOLD\", \"BITEUR\", \"ATB\", \"BITUSD\", \"AGRS\", \"DFXT\", \"HIKEN\", \"BIX\", \"KNC\", \"EOS\", \"COB\", \"COSS\", \"BMH\", \"NANO\", \"BDG\", \"BNT\", \"XVG\", \"LKK1Y\", \"LKK\", \"USDK\", \"EURN\", \"NZDT\", \"JSE\", \"GMD\", \"GNF\", \"GYD\", \"YER\", \"XPF\", \"HTG\", \"SLL\", \"SOS\", \"WST\", \"SVC\", \"SYP\", \"NEO\", \"KMF\", \"JUMP\", \"AYA\", \"BLAST\", \"WGR\", \"BCN\", \"BTG\", \"URALS\", \"INN\", \"USDQ\", \"CNH\", \"HUSD\", \"BKRW\", \"NZDX\", \"EURX\", \"CADX\", \"USDEX\", \"JPYX\", \"AUDX\", \"VNDC\", \"EON\", \"GBPX\", \"CHFX\", \"USDJ\", \"IDRT\", \"USDS\", \"USDN\", \"BIDR\", \"IDK\", \"BSD\", \"BTN\", \"KYD\", \"NIO\", \"SBD\", \"SDG\", \"SHP\", \"TOP\", \"XCD\", \"XCHF\", \"CNYT\", \"GYEN\", \"ZUSD\", \"GOLD\", \"TRX\", \"TRYB\", \"PLATC\", \"STRAX\", \"UST\", \"GLM\", \"VAI\", \"BRZ\", \"DDRST\", \"XAUT\", \"MIM\"];\n/**\n * currencies supported by the payment provider\n * Last updated: Date of commit\n */\n\nconst PROVIDER_SUPPORTED_FIAT_CURRENCIES = {\n  // https://integrations.simplex.com/supported_currencies\n  // https://support.moonpay.com/hc/en-gb/articles/360011931457-Which-fiat-currencies-are-supported-\n  [PAYMENT_PROVIDER.MOONPAY]: [\"AUD\", \"BGN\", \"BRL\", \"CAD\", \"CHF\", \"CNY\", \"COP\", \"CZK\", \"DKK\", \"DOP\", \"EGP\", \"EUR\", \"GBP\", \"HKD\", \"HRK\", \"IDR\", \"ILS\", \"JPY\", \"JOD\", \"KES\", \"KRW\", \"KWD\", \"LKR\", \"MAD\", \"MXN\", \"MYR\", \"NGN\", \"NOK\", \"NZD\", \"OMR\", \"PEN\", \"PKR\", \"PLN\", \"RON\", \"RUB\", \"SEK\", \"SGD\", \"THB\", \"TRY\", \"TWD\", \"USD\", \"VND\", \"ZAR\"],\n\n  /**\n   * https://docs.sendwyre.com/docs/supported-currencies#fiat\n   * The ones where credit card is supported\n   */\n  [PAYMENT_PROVIDER.WYRE]: [\"USD\", \"EUR\", \"GBP\", \"AUD\", \"CAD\", \"NZD\", \"ARS\", \"BRL\", \"CHF\", \"CLP\", \"COP\", \"CZK\", \"DKK\", \"HKD\", \"ILS\", \"INR\", \"ISK\", \"JPY\", \"KRW\", \"MXN\", \"MYR\", \"NOK\", \"PHP\", \"PLN\", \"SEK\", \"THB\", \"VND\", \"ZAR\"],\n  // https://support.ramp.network/en/articles/471-why-am-i-paying-in-usd-eur-gbp\n  [PAYMENT_PROVIDER.RAMPNETWORK]: [\"USD\", \"EUR\", \"GBP\"],\n  // From https://xanpool.com/ fiat select dropdown\n  [PAYMENT_PROVIDER.XANPOOL]: [\"SGD\", \"HKD\", \"THB\", \"PHP\", \"INR\", \"IDR\", \"MYR\", \"AUD\", \"NZD\", \"KRW\"],\n  // https://support.aax.com/en/articles/5295762-mercuryo\n  // RUB / UAH currently not supported\n  [PAYMENT_PROVIDER.MERCURYO]: [\"EUR\", \"USD\", \"GBP\", \"TRY\", \"JPY\", \"BRL\", \"NGN\", \"VND\", \"MXN\", \"KRW\"],\n\n  /**\n   * https://support.transak.com/hc/en-us/articles/360020615578-Credit-and-Debit-Card-Payments-through-Transak\n   * or\n   * https://transak.stoplight.io/docs/transak-docs/b3A6OTk1ODQ0-2-get-fiat-currencies\n   */\n  [PAYMENT_PROVIDER.TRANSAK]: [\"ARS\", \"AUD\", \"BBD\", \"BGN\", \"BMD\", \"BRL\", \"CAD\", \"CHF\", \"CLP\", \"CRC\", \"CZK\", \"DKK\", \"DOP\", \"EUR\", \"FJD\", \"FKP\", \"GBP\", \"GIP\", \"HRK\", \"HUF\", \"IDR\", \"ILS\", \"ISK\", \"JMD\", \"JPY\", \"KES\", \"KRW\", \"MDL\", \"MXN\", \"MYR\", \"NOK\", \"NZD\", \"PEN\", \"PHP\", \"PLN\", \"PYG\", \"RON\", \"SEK\", \"SGD\", \"THB\", \"TRY\", \"TZS\", \"USD\", \"ZAR\"],\n  [PAYMENT_PROVIDER.BANXA]: [\"EUR\", \"GBP\", \"USD\"]\n};\nconst cryptoCompareCurrenciesSet = new Set(CRYPTO_COMPARE_CURRENCIES);\n/**\n * Fiat currencies that we support\n */\n\nfunction supportedFiatCurrencies(provider) {\n  const providerSupportedFiatCurrencies = PROVIDER_SUPPORTED_FIAT_CURRENCIES[provider];\n  return providerSupportedFiatCurrencies.filter(currency => cryptoCompareCurrenciesSet.has(currency));\n}\n\nconst paymentProviders$1 = {\n  [PAYMENT_PROVIDER.MOONPAY]: {\n    line1: \"Credit/ Debit Card/ Apple Pay\",\n    line2: \"4.5% or 5 USD\",\n    line3: \"2,000/day, 10,000/mo\",\n    supportPage: \"https://help.moonpay.io/en/\",\n    minOrderValue: 24.99,\n    maxOrderValue: 50000,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.MOONPAY),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"aave\",\n        display: \"AAVE\"\n      }, {\n        value: \"bat\",\n        display: \"BAT\"\n      }, {\n        value: \"dai\",\n        display: \"DAI\"\n      }, {\n        value: \"eth\",\n        display: \"ETH\"\n      }, {\n        value: \"mkr\",\n        display: \"MKR\"\n      }, {\n        value: \"matic\",\n        display: \"MATIC\"\n      }, {\n        value: \"usdt\",\n        display: \"USDT\"\n      }, {\n        value: \"usdc\",\n        display: \"USDC\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.MATIC]: [{\n        value: \"eth_polygon\",\n        display: \"ETH\"\n      }, {\n        value: \"matic_polygon\",\n        display: \"MATIC\"\n      }, {\n        value: \"usdc_polygon\",\n        display: \"USDC\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.BSC_MAINNET]: [{\n        value: \"bnb_bsc\",\n        display: \"BNB\"\n      }, {\n        value: \"busd_bsc\",\n        display: \"BUSD\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.AVALANCHE_MAINNET]: [{\n        value: \"avax_cchain\",\n        display: \"AVAX\"\n      }]\n    },\n    includeFees: true,\n    api: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.WYRE]: {\n    line1: \"Apple Pay/ Debit/ Credit Card\",\n    line2: \"4.9% + 30 or 5 USD\",\n    line3: \"$250/day\",\n    supportPage: \"https://support.sendwyre.com/en/\",\n    minOrderValue: 5,\n    maxOrderValue: 500,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.WYRE),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"AAVE\",\n        display: \"AAVE\"\n      }, {\n        value: \"BAT\",\n        display: \"BAT\"\n      }, {\n        value: \"BUSD\",\n        display: \"BUSD\"\n      }, {\n        value: \"DAI\",\n        display: \"DAI\"\n      }, {\n        value: \"ETH\",\n        display: \"ETH\"\n      }, {\n        value: \"MKR\",\n        display: \"MKR\"\n      }, {\n        value: \"UNI\",\n        display: \"UNI\"\n      }, {\n        value: \"USDC\",\n        display: \"USDC\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.MATIC]: [{\n        value: \"MUSDC\",\n        display: \"USDC\"\n      }],\n      // AVAXC? or AVAX?\n      [SUPPORTED_PAYMENT_NETWORK.AVALANCHE_MAINNET]: [{\n        value: \"AVAXC\",\n        display: \"AVAXC\"\n      }]\n    },\n    includeFees: false,\n    api: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.RAMPNETWORK]: {\n    line1: \"Debit Card/ <br>Apple Pay/ Bank transfer\",\n    line2: \"0.49% - 2.9%\",\n    line3: \"5,000/purchase, 20,000/mo\",\n    supportPage: \"https://instant.ramp.network/\",\n    minOrderValue: 50,\n    maxOrderValue: 20000,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.RAMPNETWORK),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"ETH\",\n        display: \"ETH\"\n      }, {\n        value: \"DAI\",\n        display: \"DAI\"\n      }, {\n        value: \"USDC\",\n        display: \"USDC\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.MATIC]: [{\n        value: \"MATIC_DAI\",\n        display: \"DAI\"\n      }, {\n        value: \"MATIC_MATIC\",\n        display: \"MATIC\"\n      }, {\n        value: \"MATIC_USDC\",\n        display: \"USDC\"\n      }],\n      // what about AVAXC?\n      [SUPPORTED_PAYMENT_NETWORK.AVALANCHE_MAINNET]: [{\n        value: \"AVAX\",\n        display: \"AVAX\"\n      }] // Temporary unavailable\n      // [SUPPORTED_PAYMENT_NETWORK.XDAI]: [{ value: 'XDAI_XDAI', display: 'XDAI' }],\n\n    },\n    includeFees: true,\n    api: true,\n    receiveHint: \"walletTopUp.receiveHintRamp\",\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.XANPOOL]: {\n    line1: \"PayNow/ InstaPay/ FPS/ GoJekPay/ UPI/ PromptPay/ <br>ViettelPay/ DuitNow\",\n    line2: \"2.5% buying, 3% selling\",\n    line3: \"$2,500 / day\",\n    supportPage: \"mailto:support@xanpool.com\",\n    minOrderValue: 100,\n    maxOrderValue: 2500,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.XANPOOL),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"ETH\",\n        display: \"ETH\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }]\n    },\n    includeFees: true,\n    api: true,\n    sell: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.MERCURYO]: {\n    line1: \"Credit/ Debit Card/ Apple Pay\",\n    line2: \"3.95% or 4 USD\",\n    line3: \"10,000/day, 25,000/mo\",\n    supportPage: \"mailto:support@mercuryo.io\",\n    minOrderValue: 30,\n    maxOrderValue: 5000,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.MERCURYO),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"ETH\",\n        display: \"ETH\"\n      }, {\n        value: \"BAT\",\n        display: \"BAT\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }, {\n        value: \"DAI\",\n        display: \"DAI\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.BSC_MAINNET]: [{\n        value: \"BNB\",\n        display: \"BNB\"\n      }, {\n        value: \"BUSD\",\n        display: \"BUSD\"\n      }, {\n        value: \"1INCH\",\n        display: \"1INCH\"\n      }]\n    },\n    includeFees: true,\n    api: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.TRANSAK]: {\n    line1: \"Apple & Google Pay / Credit/Debit Card<br/>Bangkok Bank Mobile & iPay<br/>Bank Transfer (sepa/gbp) / SCB Mobile & Easy\",\n    line2: \"0.99% - 5.5% or 5 USD\",\n    line3: \"$5,000/day, $28,000/mo\",\n    supportPage: \"https://support.transak.com/hc/en-US\",\n    minOrderValue: 30,\n    maxOrderValue: 500,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.TRANSAK),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"AAVE\",\n        display: \"AAVE\"\n      }, {\n        value: \"DAI\",\n        display: \"DAI\"\n      }, {\n        value: \"ETH\",\n        display: \"ETH\"\n      }, {\n        value: \"USDC\",\n        display: \"USDC\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.MATIC]: [{\n        value: \"AAVE\",\n        display: \"AAVE\"\n      }, {\n        value: \"DAI\",\n        display: \"DAI\"\n      }, {\n        value: \"MATIC\",\n        display: \"MATIC\"\n      }, {\n        value: \"USDC\",\n        display: \"USDC\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }, {\n        value: \"WETH\",\n        display: \"WETH\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.BSC_MAINNET]: [{\n        value: \"BNB\",\n        display: \"BNB\"\n      }, {\n        value: \"BUSD\",\n        display: \"BUSD\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.AVALANCHE_MAINNET]: [{\n        value: \"AVAX\",\n        display: \"AVAX\"\n      }]\n    },\n    includeFees: true,\n    enforceMax: true\n  },\n  [PAYMENT_PROVIDER.BANXA]: {\n    line1: \"Debit Card/ <br>Apple Pay/ Bank transfer\",\n    line2: \"0.49% - 2.9%\",\n    line3: \"5,000/purchase, 20,000/mo\",\n    supportPage: \"https://support.banxa.com\",\n    minOrderValue: 20,\n    maxOrderValue: 15000,\n    validCurrencies: supportedFiatCurrencies(PAYMENT_PROVIDER.BANXA),\n    validCryptoCurrenciesByChain: {\n      [SUPPORTED_PAYMENT_NETWORK.MAINNET]: [{\n        value: \"ETH\",\n        display: \"ETH\"\n      }, {\n        value: \"USDT\",\n        display: \"USDT\"\n      }, {\n        value: \"BUSD\",\n        display: \"BUSD\"\n      }, {\n        value: \"LINK\",\n        display: \"LINK\"\n      }, {\n        value: \"USDC\",\n        display: \"USDC\"\n      }, {\n        value: \"CHZ\",\n        display: \"CHZ\"\n      }, {\n        value: \"BAT\",\n        display: \"BAT\"\n      }, {\n        value: \"MANA\",\n        display: \"MANA\"\n      }, {\n        value: \"AAVE\",\n        display: \"AAVE\"\n      }, {\n        value: \"COMP\",\n        display: \"COMP\"\n      }, {\n        value: \"ENJ\",\n        display: \"ENJ\"\n      }],\n      [SUPPORTED_PAYMENT_NETWORK.MATIC]: [{\n        value: \"MATIC\",\n        display: \"MATIC\"\n      }] // [SUPPORTED_PAYMENT_NETWORK.BSC_MAINNET]: [{ value: \"BNB\", display: \"BNB\" }],\n\n    },\n    includeFees: true,\n    enforceMax: true\n  }\n};\nconst translations = {\n  en: {\n    embed: {\n      continue: \"Continue\",\n      actionRequired: \"Authorization required\",\n      pendingAction: \"Click continue to proceed with your request in a popup\",\n      cookiesRequired: \"Cookies Required\",\n      enableCookies: \"Please enable cookies in your browser preferences to access Torus\",\n      clickHere: \"More Info\"\n    }\n  },\n  de: {\n    embed: {\n      continue: \"Fortsetzen\",\n      actionRequired: \"Autorisierung erforderlich\",\n      pendingAction: \"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren\",\n      cookiesRequired: \"Cookies bentigt\",\n      enableCookies: \"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen\",\n      clickHere: \"Mehr Info\"\n    }\n  },\n  ja: {\n    embed: {\n      continue: \"\",\n      actionRequired: \"\",\n      pendingAction: \"\",\n      cookiesRequired: \"\",\n      enableCookies: \"TorusCookie\",\n      clickHere: \"\"\n    }\n  },\n  ko: {\n    embed: {\n      continue: \"\",\n      actionRequired: \" \",\n      pendingAction: \"    .\",\n      cookiesRequired: \" \",\n      enableCookies: \"     Torus .\",\n      clickHere: \"  \"\n    }\n  },\n  zh: {\n    embed: {\n      continue: \"\",\n      actionRequired: \"\",\n      pendingAction: \"\",\n      cookiesRequired: \"Cookie\",\n      enableCookies: \"cookieTorus\",\n      clickHere: \"\"\n    }\n  }\n};\nvar configuration = {\n  supportedVerifierList: Object.values(WALLET_VERIFIERS),\n  paymentProviders: paymentProviders$1,\n  api: \"https://api.tor.us\",\n  translations,\n  prodTorusUrl: \"\",\n  localStorageKeyPrefix: `torus-`\n};\n\nconst runOnLoad = fn => new Promise((resolve, reject) => {\n  if (window.document.body != null) {\n    Promise.resolve(fn()).then(resolve).catch(reject);\n  } else {\n    window.document.addEventListener(\"DOMContentLoaded\", () => {\n      Promise.resolve(fn()).then(resolve).catch(reject);\n    });\n  }\n});\nconst htmlToElement = html => {\n  const template = window.document.createElement(\"template\");\n  const trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild;\n};\nconst handleEvent = function (handle, eventName, handler) {\n  for (var _len = arguments.length, handlerArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    handlerArgs[_key - 3] = arguments[_key];\n  }\n\n  const handlerWrapper = () => {\n    handler(...handlerArgs);\n    handle.removeEventListener(eventName, handlerWrapper);\n  };\n\n  handle.addEventListener(eventName, handlerWrapper);\n};\nconst handleStream = (handle, eventName, handler) => {\n  const handlerWrapper = chunk => {\n    handler(chunk);\n    handle.removeListener(eventName, handlerWrapper);\n  };\n\n  handle.on(eventName, handlerWrapper);\n};\nasync function documentReady() {\n  return new Promise(resolve => {\n    if (document.readyState !== \"loading\") {\n      resolve();\n    } else {\n      handleEvent(document, \"DOMContentLoaded\", resolve);\n    }\n  });\n}\n\nvar log = loglevel.getLogger(\"torus-embed\");\n\nvar messages = {\n  errors: {\n    disconnected: () => \"Torus: Lost connection to Torus.\",\n    permanentlyDisconnected: () => \"Torus: Disconnected from iframe. Page reload required.\",\n    sendSiteMetadata: () => \"Torus: Failed to send site metadata. This is an internal error, please report this bug.\",\n    unsupportedSync: method => `Torus: The Torus Ethereum provider does not support synchronous methods like ${method} without a callback parameter.`,\n    invalidDuplexStream: () => \"Must provide a Node.js-style duplex stream.\",\n    invalidOptions: (maxEventListeners, shouldSendMetadata) => `Invalid options. Received: { maxEventListeners: ${maxEventListeners}, shouldSendMetadata: ${shouldSendMetadata} }`,\n    invalidRequestArgs: () => `Expected a single, non-array, object argument.`,\n    invalidRequestMethod: () => `'args.method' must be a non-empty string.`,\n    invalidRequestParams: () => `'args.params' must be an object or array if provided.`,\n    invalidLoggerObject: () => `'args.logger' must be an object if provided.`,\n    invalidLoggerMethod: method => `'args.logger' must include required method '${method}'.`\n  },\n  info: {\n    connected: chainId => `Torus: Connected to chain with ID \"${chainId}\".`\n  },\n  warnings: {\n    // deprecated methods\n    enableDeprecation: 'Torus: \"\"ethereum.enable()\" is deprecated and may be removed in the future. ' + 'Please use \"ethereum.send(\"eth_requestAccounts\")\" instead. For more information, see: https://eips.ethereum.org/EIPS/eip-1102',\n    sendDeprecation: 'Torus: \"ethereum.send(...)\" is deprecated and may be removed in the future.' + ' Please use \"ethereum.sendAsync(...)\" or \"ethereum.request(...)\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n    events: {\n      close: 'Torus: The event \"close\" is deprecated and may be removed in the future. Please use \"disconnect\" instead.' + \"\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193\",\n      data: 'Torus: The event \"data\" is deprecated and will be removed in the future.' + 'Use \"message\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message',\n      networkChanged: 'Torus: The event \"networkChanged\" is deprecated and may be removed in the future.' + ' Please use \"chainChanged\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n      notification: 'Torus: The event \"notification\" is deprecated and may be removed in the future. ' + 'Please use \"message\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193'\n    },\n    publicConfigStore: 'Torus: The property \"publicConfigStore\" is deprecated and WILL be removed in the future.'\n  }\n};\n\nconst {\n  paymentProviders\n} = configuration;\nconst validatePaymentProvider = (provider, params) => {\n  const errors = {};\n\n  if (!provider) {\n    return {\n      errors,\n      isValid: true\n    };\n  }\n\n  if (provider && !paymentProviders[provider]) {\n    errors.provider = \"Invalid Provider\";\n    return {\n      errors,\n      isValid: Object.keys(errors).length === 0\n    };\n  }\n\n  const selectedProvider = paymentProviders[provider];\n  const selectedParams = params || {}; // set default values\n  // if (!selectedParams.selectedCurrency) [selectedParams.selectedCurrency] = selectedProvider.validCurrencies\n  // if (!selectedParams.fiatValue) selectedParams.fiatValue = selectedProvider.minOrderValue\n  // if (!selectedParams.selectedCryptoCurrency) [selectedParams.selectedCryptoCurrency] = selectedProvider.validCryptoCurrencies\n  // validations\n\n  if (selectedParams.fiatValue) {\n    const requestedOrderAmount = +parseFloat(selectedParams.fiatValue.toString()) || 0;\n    if (requestedOrderAmount < selectedProvider.minOrderValue) errors.fiatValue = \"Requested amount is lower than supported\";\n    if (requestedOrderAmount > selectedProvider.maxOrderValue && selectedProvider.enforceMax) errors.fiatValue = \"Requested amount is higher than supported\";\n  }\n\n  if (selectedParams.selectedCurrency && !selectedProvider.validCurrencies.includes(selectedParams.selectedCurrency)) {\n    errors.selectedCurrency = \"Unsupported currency\";\n  }\n\n  if (selectedParams.selectedCryptoCurrency) {\n    const validCryptoCurrenciesByChain = Object.values(selectedProvider.validCryptoCurrenciesByChain).flat().map(currency => currency.value);\n    const finalCryptoCurrency = provider === PAYMENT_PROVIDER.MOONPAY ? selectedParams.selectedCryptoCurrency.toLowerCase() : selectedParams.selectedCryptoCurrency;\n    if (validCryptoCurrenciesByChain && !validCryptoCurrenciesByChain.includes(finalCryptoCurrency)) errors.selectedCryptoCurrency = \"Unsupported cryptoCurrency\";\n  }\n\n  return {\n    errors,\n    isValid: Object.keys(errors).length === 0\n  };\n}; // utility functions\n\n/**\n * json-rpc-engine middleware that logs RPC errors and and validates req.method.\n *\n * @param log - The logging API to use.\n * @returns  json-rpc-engine middleware function\n */\n\nfunction createErrorMiddleware() {\n  return (req, res, next) => {\n    // json-rpc-engine will terminate the request when it notices this error\n    if (typeof req.method !== \"string\" || !req.method) {\n      res.error = ethErrors.rpc.invalidRequest({\n        message: `The request 'method' must be a non-empty string.`,\n        data: req\n      });\n    }\n\n    next(done => {\n      const {\n        error\n      } = res;\n\n      if (!error) {\n        return done();\n      }\n\n      log.error(`MetaMask - RPC Error: ${error.message}`, error);\n      return done();\n    });\n  };\n} // resolve response.result or response, reject errors\n/**\n * Logs a stream disconnection error. Emits an 'error' if given an\n * EventEmitter that has listeners for the 'error' event.\n *\n * @param log - The logging API to use.\n * @param remoteLabel - The label of the disconnected stream.\n * @param error - The associated error to log.\n * @param emitter - The logging API to use.\n */\n\nfunction logStreamDisconnectWarning(remoteLabel, error, emitter) {\n  let warningMsg = `MetaMask: Lost connection to \"${remoteLabel}\".`;\n\n  if (error !== null && error !== void 0 && error.stack) {\n    warningMsg += `\\n${error.stack}`;\n  }\n\n  log.warn(warningMsg);\n\n  if (emitter && emitter.listenerCount(\"error\") > 0) {\n    emitter.emit(\"error\", warningMsg);\n  }\n}\nconst getPreopenInstanceId = () => Math.random().toString(36).slice(2);\nconst getTorusUrl = async (buildEnv, integrity) => {\n  let torusUrl;\n  let logLevel; // Do not change this line\n\n  const version = \"1.37.2\";\n  let versionUsed = integrity.version || version;\n\n  try {\n    if ((buildEnv === \"binance\" || buildEnv === \"production\") && !integrity.version) {\n      let response;\n      if (!configuration.prodTorusUrl) response = await get(`${configuration.api}/latestversion?name=@toruslabs/torus-embed&version=${version}`, {}, {\n        useAPIKey: true\n      });else response = {\n        data: configuration.prodTorusUrl\n      };\n      versionUsed = response.data; // eslint-disable-next-line require-atomic-updates\n\n      configuration.prodTorusUrl = response.data;\n    }\n  } catch (error) {\n    log.error(error, \"unable to fetch latest version\");\n  }\n\n  log.info(\"version used: \", versionUsed);\n\n  switch (buildEnv) {\n    case \"binance\":\n      torusUrl = `https://binance.tor.us/v${versionUsed}`;\n      logLevel = \"info\";\n      break;\n\n    case \"testing\":\n      torusUrl = \"https://testing.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"bnb\":\n      torusUrl = \"https://bnb.tor.us\";\n      logLevel = \"error\";\n      break;\n\n    case \"polygon\":\n      torusUrl = \"https://polygon.tor.us\";\n      logLevel = \"error\";\n      break;\n\n    case \"lrc\":\n      torusUrl = \"https://lrc.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"beta\":\n      torusUrl = \"https://beta.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"development\":\n      torusUrl = \"http://localhost:4050\";\n      logLevel = \"debug\";\n      break;\n\n    default:\n      torusUrl = `https://app.tor.us/v${versionUsed}`;\n      logLevel = \"error\";\n      break;\n  }\n\n  return {\n    torusUrl,\n    logLevel\n  };\n};\nconst getUserLanguage = () => {\n  let userLanguage = window.navigator.language || \"en-US\";\n  const userLanguages = userLanguage.split(\"-\");\n  userLanguage = Object.prototype.hasOwnProperty.call(configuration.translations, userLanguages[0]) ? userLanguages[0] : \"en\";\n  return userLanguage;\n};\nconst EMITTED_NOTIFICATIONS = [\"eth_subscription\" // per eth-json-rpc-filters/subscriptionManager\n];\nconst NOOP = () => {// empty function\n};\nconst FEATURES_PROVIDER_CHANGE_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=660,width=375\";\nconst FEATURES_DEFAULT_WALLET_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=740,width=1315\";\nconst FEATURES_CONFIRM_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=450\";\nfunction getPopupFeatures() {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n  const w = 1200;\n  const h = 700;\n  const width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : window.screen.width;\n  const height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : window.screen.height;\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = `titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${h / systemZoom},width=${w / systemZoom},top=${top},left=${left}`;\n  return features;\n}\n\nfunction ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nSafeEventEmitter.defaultMaxListeners = 100; // resolve response.result, reject errors\n\nconst getRpcPromiseCallback = function (resolve, reject) {\n  let unwrapResult = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return (error, response) => {\n    if (error || response.error) {\n      return reject(error || response.error);\n    }\n\n    return !unwrapResult || Array.isArray(response) ? resolve(response) : resolve(response.result);\n  };\n};\n\nclass TorusInpageProvider extends SafeEventEmitter {\n  /**\n   * The chain ID of the currently connected Ethereum chain.\n   * See [chainId.network]{@link https://chainid.network} for more information.\n   */\n\n  /**\n   * The user's currently selected Ethereum address.\n   * If null, MetaMask is either locked or the user has not permitted any\n   * addresses to be viewed.\n   */\n\n  /**\n   * Indicating that this provider is a MetaMask provider.\n   */\n  constructor(connectionStream) {\n    let {\n      maxEventListeners = 100,\n      shouldSendMetadata = true,\n      jsonRpcStreamName = \"provider\"\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n\n    _defineProperty(this, \"chainId\", void 0);\n\n    _defineProperty(this, \"selectedAddress\", void 0);\n\n    _defineProperty(this, \"_rpcEngine\", void 0);\n\n    _defineProperty(this, \"networkVersion\", void 0);\n\n    _defineProperty(this, \"shouldSendMetadata\", void 0);\n\n    _defineProperty(this, \"isTorus\", void 0);\n\n    _defineProperty(this, \"_publicConfigStore\", void 0);\n\n    _defineProperty(this, \"tryPreopenHandle\", void 0);\n\n    _defineProperty(this, \"enable\", void 0);\n\n    _defineProperty(this, \"_state\", void 0);\n\n    _defineProperty(this, \"_jsonRpcConnection\", void 0);\n\n    _defineProperty(this, \"_sentWarnings\", {\n      // methods\n      enable: false,\n      experimentalMethods: false,\n      send: false,\n      publicConfigStore: false,\n      // events\n      events: {\n        close: false,\n        data: false,\n        networkChanged: false,\n        notification: false\n      }\n    });\n\n    if (!duplex(connectionStream)) {\n      throw new Error(messages.errors.invalidDuplexStream());\n    }\n\n    this.isTorus = true;\n    this.setMaxListeners(maxEventListeners); // private state\n\n    this._state = _objectSpread$1({}, TorusInpageProvider._defaultState); // public state\n\n    this.selectedAddress = null;\n    this.networkVersion = null;\n    this.chainId = null;\n    this.shouldSendMetadata = shouldSendMetadata; // bind functions (to prevent e.g. web3@1.x from making unbound calls)\n\n    this._handleAccountsChanged = this._handleAccountsChanged.bind(this);\n    this._handleChainChanged = this._handleChainChanged.bind(this);\n    this._handleUnlockStateChanged = this._handleUnlockStateChanged.bind(this);\n    this._handleConnect = this._handleConnect.bind(this);\n    this._handleDisconnect = this._handleDisconnect.bind(this);\n    this._handleStreamDisconnect = this._handleStreamDisconnect.bind(this);\n    this._sendSync = this._sendSync.bind(this);\n    this._rpcRequest = this._rpcRequest.bind(this);\n    this._warnOfDeprecation = this._warnOfDeprecation.bind(this);\n    this._initializeState = this._initializeState.bind(this);\n    this.request = this.request.bind(this);\n    this.send = this.send.bind(this);\n    this.sendAsync = this.sendAsync.bind(this); // this.enable = this.enable.bind(this);\n    // setup connectionStream multiplexing\n\n    const mux = new ObjectMultiplex();\n    pump(connectionStream, mux, connectionStream, this._handleStreamDisconnect.bind(this, \"MetaMask\")); // subscribe to metamask public config (one-way)\n\n    this._publicConfigStore = new ObservableStore({\n      storageKey: \"Metamask-Config\"\n    }); // handle isUnlocked changes, and chainChanged and networkChanged events\n    // this._publicConfigStore.subscribe((stringifiedState) => {\n    //   // This is because we are using store as string\n    //   const state = JSON.parse(stringifiedState as unknown as string);\n    //   if (\"isUnlocked\" in state && state.isUnlocked !== this._state.isUnlocked) {\n    //     this._state.isUnlocked = state.isUnlocked;\n    //     if (!this._state.isUnlocked) {\n    //       // accounts are never exposed when the extension is locked\n    //       this._handleAccountsChanged([]);\n    //     } else {\n    //       // this will get the exposed accounts, if any\n    //       try {\n    //         this._rpcRequest(\n    //           { method: \"eth_accounts\", params: [] },\n    //           NOOP,\n    //           true // indicating that eth_accounts _should_ update accounts\n    //         );\n    //       } catch (_) {\n    //         // Swallow error\n    //       }\n    //     }\n    //   }\n    //   if (\"selectedAddress\" in state && this.selectedAddress !== state.selectedAddress) {\n    //     try {\n    //       this._rpcRequest(\n    //         { method: \"eth_accounts\", params: [] },\n    //         NOOP,\n    //         true // indicating that eth_accounts _should_ update accounts\n    //       );\n    //     } catch (_) {\n    //       // Swallow error\n    //     }\n    //   }\n    //   // Emit chainChanged event on chain change\n    //   if (\"chainId\" in state && state.chainId !== this.chainId) {\n    //     this.chainId = state.chainId || null;\n    //     this.emit(\"chainChanged\", this.chainId);\n    //     // indicate that we've connected, for EIP-1193 compliance\n    //     // we do this here so that iframe can initialize\n    //     if (!this._state.hasEmittedConnection) {\n    //       this._handleConnect(this.chainId);\n    //       this._state.hasEmittedConnection = true;\n    //     }\n    //   }\n    //   // Emit networkChanged event on network change\n    //   if (\"networkVersion\" in state && state.networkVersion !== this.networkVersion) {\n    //     this.networkVersion = state.networkVersion || null;\n    //     this.emit(\"networkChanged\", this.networkVersion);\n    //   }\n    // });\n\n    pump(mux.createStream(\"publicConfig\"), storeAsStream(this._publicConfigStore), // RPC requests should still work if only this stream fails\n    logStreamDisconnectWarning.bind(this, \"MetaMask PublicConfigStore\")); // ignore phishing warning message (handled elsewhere)\n\n    mux.ignoreStream(\"phishing\"); // setup own event listeners\n    // EIP-1193 connect\n\n    this.on(\"connect\", () => {\n      this._state.isConnected = true;\n    }); // connect to async provider\n\n    const jsonRpcConnection = createStreamMiddleware();\n    pump(jsonRpcConnection.stream, mux.createStream(jsonRpcStreamName), jsonRpcConnection.stream, this._handleStreamDisconnect.bind(this, \"MetaMask RpcProvider\")); // handle RPC requests via dapp-side rpc engine\n\n    const rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(createErrorMiddleware());\n    rpcEngine.push(jsonRpcConnection.middleware);\n    this._rpcEngine = rpcEngine; // json rpc notification listener\n\n    jsonRpcConnection.events.on(\"notification\", payload => {\n      const {\n        method,\n        params\n      } = payload;\n\n      if (method === \"wallet_accountsChanged\") {\n        this._handleAccountsChanged(params);\n      } else if (method === \"wallet_unlockStateChanged\") {\n        this._handleUnlockStateChanged(params);\n      } else if (method === \"wallet_chainChanged\") {\n        this._handleChainChanged(params);\n      } else if (EMITTED_NOTIFICATIONS.includes(payload.method)) {\n        // EIP 1193 subscriptions, per eth-json-rpc-filters/subscriptionManager\n        this.emit(\"data\", payload); // deprecated\n\n        this.emit(\"notification\", params.result);\n        this.emit(\"message\", {\n          type: method,\n          data: params\n        });\n      } // Backward compatibility for older non EIP 1193 subscriptions\n      // this.emit('data', null, payload)\n\n    });\n  }\n\n  get publicConfigStore() {\n    if (!this._sentWarnings.publicConfigStore) {\n      log.warn(messages.warnings.publicConfigStore);\n      this._sentWarnings.publicConfigStore = true;\n    }\n\n    return this._publicConfigStore;\n  }\n  /**\n   * Returns whether the inpage provider is connected to Torus.\n   */\n\n\n  isConnected() {\n    return this._state.isConnected;\n  }\n  /**\n   * Submits an RPC request for the given method, with the given params.\n   * Resolves with the result of the method call, or rejects on error.\n   *\n   * @param args - The RPC request arguments.\n   * @returns A Promise that resolves with the result of the RPC method,\n   * or rejects if an error is encountered.\n   */\n\n\n  async request(args) {\n    if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n      throw ethErrors.rpc.invalidRequest({\n        message: messages.errors.invalidRequestArgs(),\n        data: args\n      });\n    }\n\n    const {\n      method,\n      params\n    } = args;\n\n    if (typeof method !== \"string\" || method.length === 0) {\n      throw ethErrors.rpc.invalidRequest({\n        message: messages.errors.invalidRequestMethod(),\n        data: args\n      });\n    }\n\n    if (params !== undefined && !Array.isArray(params) && (typeof params !== \"object\" || params === null)) {\n      throw ethErrors.rpc.invalidRequest({\n        message: messages.errors.invalidRequestParams(),\n        data: args\n      });\n    }\n\n    return new Promise((resolve, reject) => {\n      this._rpcRequest({\n        method,\n        params\n      }, getRpcPromiseCallback(resolve, reject));\n    });\n  }\n  /**\n   * Submits an RPC request per the given JSON-RPC request object.\n   *\n   * @param payload - The RPC request object.\n   * @param cb - The callback function.\n   */\n\n\n  sendAsync(payload, callback) {\n    this._rpcRequest(payload, callback);\n  }\n  /**\n   * We override the following event methods so that we can warn consumers\n   * about deprecated events:\n   *   addListener, on, once, prependListener, prependOnceListener\n   */\n\n\n  addListener(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.addListener(eventName, listener);\n  }\n\n  on(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.on(eventName, listener);\n  }\n\n  once(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.once(eventName, listener);\n  }\n\n  prependListener(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.prependListener(eventName, listener);\n  }\n\n  prependOnceListener(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.prependOnceListener(eventName, listener);\n  } // Private Methods\n  //= ===================\n\n  /**\n   * Constructor helper.\n   * Populates initial state by calling 'wallet_getProviderState' and emits\n   * necessary events.\n   */\n\n\n  async _initializeState() {\n    try {\n      const {\n        accounts,\n        chainId,\n        isUnlocked,\n        networkVersion\n      } = await this.request({\n        method: \"wallet_getProviderState\"\n      }); // indicate that we've connected, for EIP-1193 compliance\n\n      this.emit(\"connect\", {\n        chainId\n      });\n\n      this._handleChainChanged({\n        chainId,\n        networkVersion\n      });\n\n      this._handleUnlockStateChanged({\n        accounts,\n        isUnlocked\n      });\n\n      this._handleAccountsChanged(accounts);\n    } catch (error) {\n      log.error(\"MetaMask: Failed to get initial state. Please report this bug.\", error);\n    } finally {\n      log.info(\"initialized state\");\n      this._state.initialized = true;\n      this.emit(\"_initialized\");\n    }\n  }\n  /**\n   * Internal RPC method. Forwards requests to background via the RPC engine.\n   * Also remap ids inbound and outbound.\n   *\n   * @param payload - The RPC request object.\n   * @param callback - The consumer's callback.\n   * @param isInternal - false - Whether the request is internal.\n   */\n\n\n  _rpcRequest(payload, callback) {\n    let isInternal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    let cb = callback;\n    const _payload = payload;\n\n    if (!Array.isArray(_payload)) {\n      if (!_payload.jsonrpc) {\n        _payload.jsonrpc = \"2.0\";\n      }\n\n      if (_payload.method === \"eth_accounts\" || _payload.method === \"eth_requestAccounts\") {\n        // handle accounts changing\n        cb = (err, res) => {\n          this._handleAccountsChanged(res.result || [], _payload.method === \"eth_accounts\", isInternal);\n\n          callback(err, res);\n        };\n      } else if (_payload.method === \"wallet_getProviderState\") {\n        this._rpcEngine.handle(payload, cb);\n\n        return;\n      }\n    }\n\n    this.tryPreopenHandle(_payload, cb);\n  }\n\n  send(methodOrPayload, callbackOrArgs) {\n    if (!this._sentWarnings.send) {\n      log.warn(messages.warnings.sendDeprecation);\n      this._sentWarnings.send = true;\n    }\n\n    if (typeof methodOrPayload === \"string\" && (!callbackOrArgs || Array.isArray(callbackOrArgs))) {\n      return new Promise((resolve, reject) => {\n        try {\n          this._rpcRequest({\n            method: methodOrPayload,\n            params: callbackOrArgs\n          }, getRpcPromiseCallback(resolve, reject, false));\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n\n    if (methodOrPayload && typeof methodOrPayload === \"object\" && typeof callbackOrArgs === \"function\") {\n      return this._rpcRequest(methodOrPayload, callbackOrArgs);\n    }\n\n    return this._sendSync(methodOrPayload);\n  }\n  /**\n   * DEPRECATED.\n   * Internal backwards compatibility method, used in send.\n   */\n\n\n  _sendSync(payload) {\n    let result;\n\n    switch (payload.method) {\n      case \"eth_accounts\":\n        result = this.selectedAddress ? [this.selectedAddress] : [];\n        break;\n\n      case \"eth_coinbase\":\n        result = this.selectedAddress || null;\n        break;\n\n      case \"eth_uninstallFilter\":\n        this._rpcRequest(payload, NOOP);\n\n        result = true;\n        break;\n\n      case \"net_version\":\n        result = this.networkVersion || null;\n        break;\n\n      default:\n        throw new Error(messages.errors.unsupportedSync(payload.method));\n    }\n\n    return {\n      id: payload.id,\n      jsonrpc: payload.jsonrpc,\n      result\n    };\n  }\n  /**\n   * When the provider becomes connected, updates internal state and emits\n   * required events. Idempotent.\n   *\n   * @param chainId - The ID of the newly connected chain.\n   * emits MetaMaskInpageProvider#connect\n   */\n\n\n  _handleConnect(chainId) {\n    if (!this._state.isConnected) {\n      this._state.isConnected = true;\n      this.emit(\"connect\", {\n        chainId\n      });\n      log.debug(messages.info.connected(chainId));\n    }\n  }\n  /**\n   * When the provider becomes disconnected, updates internal state and emits\n   * required events. Idempotent with respect to the isRecoverable parameter.\n   *\n   * Error codes per the CloseEvent status codes as required by EIP-1193:\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n   *\n   * @param isRecoverable - Whether the disconnection is recoverable.\n   * @param errorMessage - A custom error message.\n   * emits MetaMaskInpageProvider#disconnect\n   */\n\n\n  _handleDisconnect(isRecoverable, errorMessage) {\n    if (this._state.isConnected || !this._state.isPermanentlyDisconnected && !isRecoverable) {\n      this._state.isConnected = false;\n      let error;\n\n      if (isRecoverable) {\n        error = new EthereumRpcError(1013, // Try again later\n        errorMessage || messages.errors.disconnected());\n        log.debug(error);\n      } else {\n        error = new EthereumRpcError(1011, // Internal error\n        errorMessage || messages.errors.permanentlyDisconnected());\n        log.error(error);\n        this.chainId = null;\n        this._state.accounts = null;\n        this.selectedAddress = null;\n        this._state.isUnlocked = false;\n        this._state.isPermanentlyDisconnected = true;\n      }\n\n      this.emit(\"disconnect\", error);\n    }\n  }\n  /**\n   * Called when connection is lost to critical streams.\n   *\n   * emits MetamaskInpageProvider#disconnect\n   */\n\n\n  _handleStreamDisconnect(streamName, error) {\n    logStreamDisconnectWarning(streamName, error, this);\n\n    this._handleDisconnect(false, error ? error.message : undefined);\n  }\n  /**\n   * Called when accounts may have changed.\n   */\n\n\n  _handleAccountsChanged(accounts) {\n    let isEthAccounts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    let isInternal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    // defensive programming\n    let finalAccounts = accounts;\n\n    if (!Array.isArray(finalAccounts)) {\n      log.error(\"MetaMask: Received non-array accounts parameter. Please report this bug.\", finalAccounts);\n      finalAccounts = [];\n    }\n\n    for (const account of accounts) {\n      if (typeof account !== \"string\") {\n        log.error(\"MetaMask: Received non-string account. Please report this bug.\", accounts);\n        finalAccounts = [];\n        break;\n      }\n    } // emit accountsChanged if anything about the accounts array has changed\n\n\n    if (!dequal(this._state.accounts, finalAccounts)) {\n      // we should always have the correct accounts even before eth_accounts\n      // returns, except in cases where isInternal is true\n      if (isEthAccounts && Array.isArray(this._state.accounts) && this._state.accounts.length > 0 && !isInternal) {\n        log.error('MetaMask: \"eth_accounts\" unexpectedly updated accounts. Please report this bug.', finalAccounts);\n      }\n\n      this._state.accounts = finalAccounts;\n      this.emit(\"accountsChanged\", finalAccounts);\n    } // handle selectedAddress\n\n\n    if (this.selectedAddress !== finalAccounts[0]) {\n      this.selectedAddress = finalAccounts[0] || null;\n    }\n  }\n  /**\n   * Upon receipt of a new chainId and networkVersion, emits corresponding\n   * events and sets relevant public state.\n   * Does nothing if neither the chainId nor the networkVersion are different\n   * from existing values.\n   *\n   * emits MetamaskInpageProvider#chainChanged\n   * @param networkInfo - An object with network info.\n   */\n\n\n  _handleChainChanged() {\n    let {\n      chainId,\n      networkVersion\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (!chainId || !networkVersion) {\n      log.error(\"MetaMask: Received invalid network parameters. Please report this bug.\", {\n        chainId,\n        networkVersion\n      });\n      return;\n    }\n\n    if (networkVersion === \"loading\") {\n      this._handleDisconnect(true);\n    } else {\n      this._handleConnect(chainId);\n\n      if (chainId !== this.chainId) {\n        this.chainId = chainId;\n\n        if (this._state.initialized) {\n          this.emit(\"chainChanged\", this.chainId);\n        }\n      }\n    }\n  }\n  /**\n   * Upon receipt of a new isUnlocked state, sets relevant public state.\n   * Calls the accounts changed handler with the received accounts, or an empty\n   * array.\n   *\n   * Does nothing if the received value is equal to the existing value.\n   * There are no lock/unlock events.\n   *\n   * @param opts - Options bag.\n   */\n\n\n  _handleUnlockStateChanged() {\n    let {\n      accounts,\n      isUnlocked\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (typeof isUnlocked !== \"boolean\") {\n      log.error(\"MetaMask: Received invalid isUnlocked parameter. Please report this bug.\", {\n        isUnlocked\n      });\n      return;\n    }\n\n    if (isUnlocked !== this._state.isUnlocked) {\n      this._state.isUnlocked = isUnlocked;\n\n      this._handleAccountsChanged(accounts || []);\n    }\n  }\n  /**\n   * Warns of deprecation for the given event, if applicable.\n   */\n\n\n  _warnOfDeprecation(eventName) {\n    if (this._sentWarnings.events[eventName] === false) {\n      log.warn(messages.warnings.events[eventName]);\n      this._sentWarnings.events[eventName] = true;\n    }\n  }\n\n}\n\n_defineProperty(TorusInpageProvider, \"_defaultState\", {\n  accounts: null,\n  isConnected: false,\n  isUnlocked: false,\n  initialized: false,\n  isPermanentlyDisconnected: false,\n  hasEmittedConnection: false\n});\n\nconst defaults = options => ({\n  algorithms: options.algorithms || [\"sha256\"],\n  delimiter: options.delimiter || \" \",\n  full: options.full || false\n}); // Generate list of hashes\n\n\nconst hashes = (options, data) => {\n  const internalHashes = {};\n  options.algorithms.forEach(algorithm => {\n    internalHashes[algorithm] = createHash(algorithm).update(data, \"utf8\").digest(\"base64\");\n  });\n  return internalHashes;\n}; // Build an integrity string\n\n\nconst integrity = (options, sri) => {\n  let output = \"\"; // Hash list\n\n  output += Object.keys(sri.hashes).map(algorithm => `${algorithm}-${sri.hashes[algorithm]}`).join(options.delimiter);\n  return output;\n};\n\nconst main = (options, data) => {\n  // Defaults\n  const finalOptions = defaults(options);\n  const sri = {\n    hashes: hashes(finalOptions, data),\n    integrity: undefined\n  };\n  sri.integrity = integrity(finalOptions, sri);\n  return finalOptions.full ? sri : sri.integrity;\n};\n\nclass PopupHandler extends EventEmitter {\n  constructor(_ref) {\n    let {\n      url,\n      target,\n      features\n    } = _ref;\n    super();\n\n    _defineProperty(this, \"url\", void 0);\n\n    _defineProperty(this, \"target\", void 0);\n\n    _defineProperty(this, \"features\", void 0);\n\n    _defineProperty(this, \"window\", void 0);\n\n    _defineProperty(this, \"windowTimer\", void 0);\n\n    _defineProperty(this, \"iClosedWindow\", void 0);\n\n    this.url = url;\n    this.target = target || \"_blank\";\n    this.features = features || getPopupFeatures();\n    this.window = undefined;\n    this.windowTimer = undefined;\n    this.iClosedWindow = false;\n\n    this._setupTimer();\n  }\n\n  _setupTimer() {\n    this.windowTimer = Number(setInterval(() => {\n      if (this.window && this.window.closed) {\n        clearInterval(this.windowTimer);\n\n        if (!this.iClosedWindow) {\n          this.emit(\"close\");\n        }\n\n        this.iClosedWindow = false;\n        this.window = undefined;\n      }\n\n      if (this.window === undefined) clearInterval(this.windowTimer);\n    }, 500));\n  }\n\n  open() {\n    var _this$window;\n\n    this.window = window.open(this.url.href, this.target, this.features);\n    if ((_this$window = this.window) !== null && _this$window !== void 0 && _this$window.focus) this.window.focus();\n    return Promise.resolve();\n  }\n\n  close() {\n    this.iClosedWindow = true;\n    if (this.window) this.window.close();\n  }\n\n  redirect(locationReplaceOnRedirect) {\n    if (locationReplaceOnRedirect) {\n      window.location.replace(this.url.href);\n    } else {\n      window.location.href = this.url.href;\n    }\n  }\n\n}\n\n/**\n * Returns whether the given image URL exists\n * @param url - the url of the image\n * @returns - whether the image exists\n */\n\nfunction imgExists(url) {\n  return new Promise((resolve, reject) => {\n    try {\n      const img = document.createElement(\"img\");\n\n      img.onload = () => resolve(true);\n\n      img.onerror = () => resolve(false);\n\n      img.src = url;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n/**\n * Extracts a name for the site from the DOM\n */\n\n\nconst getSiteName = window => {\n  const {\n    document\n  } = window;\n  const siteName = document.querySelector('head > meta[property=\"og:site_name\"]');\n\n  if (siteName) {\n    return siteName.content;\n  }\n\n  const metaTitle = document.querySelector('head > meta[name=\"title\"]');\n\n  if (metaTitle) {\n    return metaTitle.content;\n  }\n\n  if (document.title && document.title.length > 0) {\n    return document.title;\n  }\n\n  return window.location.hostname;\n};\n/**\n * Extracts an icon for the site from the DOM\n */\n\n\nasync function getSiteIcon(window) {\n  const {\n    document\n  } = window; // Use the site's favicon if it exists\n\n  let icon = document.querySelector('head > link[rel=\"shortcut icon\"]');\n\n  if (icon && (await imgExists(icon.href))) {\n    return icon.href;\n  } // Search through available icons in no particular order\n\n\n  icon = Array.from(document.querySelectorAll('head > link[rel=\"icon\"]')).find(_icon => Boolean(_icon.href));\n\n  if (icon && (await imgExists(icon.href))) {\n    return icon.href;\n  }\n\n  return null;\n}\n/**\n * Gets site metadata and returns it\n *\n */\n\n\nconst getSiteMetadata = async () => ({\n  name: getSiteName(window),\n  icon: await getSiteIcon(window)\n});\n/**\n * Sends site metadata over an RPC request.\n */\n\n\nasync function sendSiteMetadata(engine) {\n  try {\n    const domainMetadata = await getSiteMetadata(); // call engine.handle directly to avoid normal RPC request handling\n\n    engine.handle({\n      jsonrpc: \"2.0\",\n      id: getPreopenInstanceId(),\n      method: \"wallet_sendDomainMetadata\",\n      params: domainMetadata\n    }, NOOP);\n  } catch (error) {\n    log.error({\n      message: messages.errors.sendSiteMetadata(),\n      originalError: error\n    });\n  }\n}\n\nconst _excluded = [\"host\", \"chainId\", \"networkName\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nconst defaultVerifiers = {\n  [LOGIN_PROVIDER.GOOGLE]: true,\n  [LOGIN_PROVIDER.FACEBOOK]: true,\n  [LOGIN_PROVIDER.REDDIT]: true,\n  [LOGIN_PROVIDER.TWITCH]: true,\n  [LOGIN_PROVIDER.DISCORD]: true\n};\nconst iframeIntegrity = \"sha384-8cr36mP71Xpu3D2M0o8JqjSp4QJqXrJZKQ3CMRQhBWWwO77BOvBlrqotHA69dyY8\";\nconst expectedCacheControlHeader = \"max-age=3600\";\nconst UNSAFE_METHODS = [\"eth_sendTransaction\", \"eth_signTypedData\", \"eth_signTypedData_v3\", \"eth_signTypedData_v4\", \"personal_sign\", \"eth_getEncryptionPublicKey\", \"eth_decrypt\"]; // preload for iframe doesn't work https://bugs.chromium.org/p/chromium/issues/detail?id=593267\n\n(async function preLoadIframe() {\n  try {\n    if (typeof document === \"undefined\") return;\n    const torusIframeHtml = document.createElement(\"link\");\n    const {\n      torusUrl\n    } = await getTorusUrl(\"production\", {\n      check: false,\n      hash: iframeIntegrity,\n      version: \"\"\n    });\n    torusIframeHtml.href = `${torusUrl}/popup`;\n    torusIframeHtml.crossOrigin = \"anonymous\";\n    torusIframeHtml.type = \"text/html\";\n    torusIframeHtml.rel = \"prefetch\";\n\n    if (torusIframeHtml.relList && torusIframeHtml.relList.supports) {\n      if (torusIframeHtml.relList.supports(\"prefetch\")) {\n        document.head.appendChild(torusIframeHtml);\n      }\n    }\n  } catch (error) {\n    log.warn(error);\n  }\n})();\n\nclass Torus {\n  constructor() {\n    let {\n      buttonPosition = BUTTON_POSITION.BOTTOM_LEFT,\n      buttonSize = 56,\n      modalZIndex = 99999,\n      apiKey = \"torus-default\"\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _defineProperty(this, \"buttonPosition\", BUTTON_POSITION.BOTTOM_LEFT);\n\n    _defineProperty(this, \"buttonSize\", void 0);\n\n    _defineProperty(this, \"torusUrl\", void 0);\n\n    _defineProperty(this, \"torusIframe\", void 0);\n\n    _defineProperty(this, \"styleLink\", void 0);\n\n    _defineProperty(this, \"isLoggedIn\", void 0);\n\n    _defineProperty(this, \"isInitialized\", void 0);\n\n    _defineProperty(this, \"torusWidgetVisibility\", void 0);\n\n    _defineProperty(this, \"torusAlert\", void 0);\n\n    _defineProperty(this, \"apiKey\", void 0);\n\n    _defineProperty(this, \"modalZIndex\", void 0);\n\n    _defineProperty(this, \"alertZIndex\", void 0);\n\n    _defineProperty(this, \"torusAlertContainer\", void 0);\n\n    _defineProperty(this, \"isIframeFullScreen\", void 0);\n\n    _defineProperty(this, \"whiteLabel\", void 0);\n\n    _defineProperty(this, \"requestedVerifier\", void 0);\n\n    _defineProperty(this, \"currentVerifier\", void 0);\n\n    _defineProperty(this, \"embedTranslations\", void 0);\n\n    _defineProperty(this, \"ethereum\", void 0);\n\n    _defineProperty(this, \"provider\", void 0);\n\n    _defineProperty(this, \"communicationMux\", void 0);\n\n    _defineProperty(this, \"isLoginCallback\", void 0);\n\n    _defineProperty(this, \"paymentProviders\", configuration.paymentProviders);\n\n    _defineProperty(this, \"loginHint\", \"\");\n\n    _defineProperty(this, \"useWalletConnect\", void 0);\n\n    _defineProperty(this, \"isCustomLogin\", false);\n\n    this.buttonPosition = buttonPosition;\n    this.buttonSize = buttonSize;\n    this.torusUrl = \"\";\n    this.isLoggedIn = false; // ethereum.enable working\n\n    this.isInitialized = false; // init done\n\n    this.torusWidgetVisibility = true;\n    this.requestedVerifier = \"\";\n    this.currentVerifier = \"\"; // this.nodeDetailManager = new NodeDetailManager();\n    // this.torusJs = new TorusJs({\n    //   metadataHost: \"https://metadata.tor.us\",\n    //   allowHost: \"https://signer.tor.us/api/allow\",\n    //   network: \"mainnet\",\n    // });\n\n    this.apiKey = apiKey;\n    setAPIKey(apiKey);\n    this.modalZIndex = modalZIndex;\n    this.alertZIndex = modalZIndex + 1000;\n    this.isIframeFullScreen = false;\n  }\n\n  async init() {\n    let {\n      buildEnv = TORUS_BUILD_ENV.PRODUCTION,\n      enableLogging = false,\n      // deprecated: use loginConfig instead\n      enabledVerifiers = defaultVerifiers,\n      network = {\n        host: \"mainnet\",\n        chainId: null,\n        networkName: \"\",\n        blockExplorer: \"\",\n        ticker: \"\",\n        tickerName: \"\"\n      },\n      loginConfig = {},\n      showTorusButton = true,\n      integrity = {\n        check: false,\n        hash: iframeIntegrity,\n        version: \"\"\n      },\n      whiteLabel,\n      skipTKey = false,\n      useWalletConnect = false,\n      mfaLevel = \"default\"\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (this.isInitialized) throw new Error(\"Already initialized\");\n    const {\n      torusUrl,\n      logLevel\n    } = await getTorusUrl(buildEnv, integrity);\n    log.info(torusUrl, \"url loaded\");\n    this.torusUrl = torusUrl;\n    this.whiteLabel = whiteLabel;\n    this.useWalletConnect = useWalletConnect;\n    this.isCustomLogin = !!(loginConfig && Object.keys(loginConfig).length > 0) || !!(whiteLabel && Object.keys(whiteLabel).length > 0);\n    log.setDefaultLevel(logLevel);\n    if (enableLogging) log.enableAll();else log.disableAll();\n    this.torusWidgetVisibility = showTorusButton;\n    const torusIframeUrl = new URL(torusUrl);\n    if (torusIframeUrl.pathname.endsWith(\"/\")) torusIframeUrl.pathname += \"popup\";else torusIframeUrl.pathname += \"/popup\";\n    torusIframeUrl.hash = `#isCustomLogin=${this.isCustomLogin}`; // Iframe code\n\n    this.torusIframe = htmlToElement(`<iframe\n        id=\"torusIframe\"\n        allow=${useWalletConnect ? \"camera\" : \"\"}\n        class=\"torusIframe\"\n        src=\"${torusIframeUrl.href}\"\n        style=\"display: none; position: fixed; top: 0; right: 0; width: 100%; color-scheme: none;\n        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex}\"\n      ></iframe>`);\n    this.torusAlertContainer = htmlToElement('<div id=\"torusAlertContainer\"></div>');\n    this.torusAlertContainer.style.display = \"none\";\n    this.torusAlertContainer.style.setProperty(\"z-index\", this.alertZIndex.toString());\n    const link = window.document.createElement(\"link\");\n    link.setAttribute(\"rel\", \"stylesheet\");\n    link.setAttribute(\"type\", \"text/css\");\n    link.setAttribute(\"href\", `${torusUrl}/css/widget.css`);\n    this.styleLink = link;\n    const {\n      defaultLanguage = getUserLanguage(),\n      customTranslations = {}\n    } = this.whiteLabel || {};\n    const mergedTranslations = deepmerge(configuration.translations, customTranslations);\n    const languageTranslations = mergedTranslations[defaultLanguage] || configuration.translations[getUserLanguage()];\n    this.embedTranslations = languageTranslations.embed;\n\n    const handleSetup = async () => {\n      await documentReady();\n      return new Promise((resolve, reject) => {\n        this.torusIframe.onload = async () => {\n          // only do this if iframe is not full screen\n          this._setupWeb3();\n\n          const initStream = this.communicationMux.getStream(\"init_stream\");\n          initStream.on(\"data\", chunk => {\n            const {\n              name,\n              data,\n              error\n            } = chunk;\n\n            if (name === \"init_complete\" && data.success) {\n              // resolve promise\n              this.isInitialized = true;\n\n              this._displayIframe(this.isIframeFullScreen);\n\n              resolve(undefined);\n            } else if (error) {\n              reject(new Error(error));\n            }\n          });\n          initStream.write({\n            name: \"init_stream\",\n            data: {\n              enabledVerifiers,\n              loginConfig,\n              whiteLabel: this.whiteLabel,\n              buttonPosition: this.buttonPosition,\n              buttonSize: this.buttonSize,\n              torusWidgetVisibility: this.torusWidgetVisibility,\n              apiKey: this.apiKey,\n              skipTKey,\n              network,\n              mfaLevel\n            }\n          });\n        };\n\n        window.document.head.appendChild(this.styleLink);\n        window.document.body.appendChild(this.torusIframe);\n        window.document.body.appendChild(this.torusAlertContainer);\n      });\n    };\n\n    if (buildEnv === \"production\" && integrity.check) {\n      // hacky solution to check for iframe integrity\n      const fetchUrl = `${torusUrl}/popup`;\n      const resp = await fetch(fetchUrl, {\n        cache: \"reload\"\n      });\n\n      if (resp.headers.get(\"Cache-Control\") !== expectedCacheControlHeader) {\n        throw new Error(`Unexpected Cache-Control headers, got ${resp.headers.get(\"Cache-Control\")}`);\n      }\n\n      const response = await resp.text();\n      const calculatedIntegrity = main({\n        algorithms: [\"sha384\"]\n      }, response);\n      log.info(calculatedIntegrity, \"integrity\");\n\n      if (calculatedIntegrity === integrity.hash) {\n        await handleSetup();\n      } else {\n        this.clearInit();\n        throw new Error(\"Integrity check failed\");\n      }\n    } else {\n      await handleSetup();\n    }\n\n    return undefined;\n  }\n\n  login() {\n    let {\n      verifier = \"\",\n      login_hint: loginHint = \"\"\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (!this.isInitialized) throw new Error(\"Call init() first\");\n    this.requestedVerifier = verifier;\n    this.loginHint = loginHint;\n    return this.ethereum.enable();\n  }\n\n  logout() {\n    return new Promise((resolve, reject) => {\n      if (!this.isLoggedIn) {\n        reject(new Error(\"User has not logged in yet\"));\n        return;\n      }\n\n      const logOutStream = this.communicationMux.getStream(\"logout\");\n      logOutStream.write({\n        name: \"logOut\"\n      });\n      const statusStream = this.communicationMux.getStream(\"status\");\n\n      const statusStreamHandler = status => {\n        if (!status.loggedIn) {\n          this.isLoggedIn = false;\n          this.currentVerifier = \"\";\n          this.requestedVerifier = \"\";\n          resolve();\n        } else reject(new Error(\"Some Error Occured\"));\n      };\n\n      handleStream(statusStream, \"data\", statusStreamHandler);\n    });\n  }\n\n  async cleanUp() {\n    if (this.isLoggedIn) {\n      await this.logout();\n    }\n\n    this.clearInit();\n  }\n\n  clearInit() {\n    function isElement(element) {\n      return element instanceof Element || element instanceof HTMLDocument;\n    }\n\n    if (isElement(this.styleLink) && window.document.body.contains(this.styleLink)) {\n      this.styleLink.remove();\n      this.styleLink = undefined;\n    }\n\n    if (isElement(this.torusIframe) && window.document.body.contains(this.torusIframe)) {\n      this.torusIframe.remove();\n      this.torusIframe = undefined;\n    }\n\n    if (isElement(this.torusAlertContainer) && window.document.body.contains(this.torusAlertContainer)) {\n      this.torusAlert = undefined;\n      this.torusAlertContainer.remove();\n      this.torusAlertContainer = undefined;\n    }\n\n    this.isInitialized = false;\n  }\n\n  hideTorusButton() {\n    this.torusWidgetVisibility = false;\n\n    this._sendWidgetVisibilityStatus(false);\n\n    this._displayIframe();\n  }\n\n  showTorusButton() {\n    this.torusWidgetVisibility = true;\n\n    this._sendWidgetVisibilityStatus(true);\n\n    this._displayIframe();\n  }\n\n  setProvider(_ref) {\n    let {\n      host = \"mainnet\",\n      chainId = null,\n      networkName = \"\"\n    } = _ref,\n        rest = _objectWithoutProperties(_ref, _excluded);\n\n    return new Promise((resolve, reject) => {\n      const providerChangeStream = this.communicationMux.getStream(\"provider_change\");\n\n      const handler = chunk => {\n        const {\n          err,\n          success\n        } = chunk.data;\n        log.info(chunk);\n\n        if (err) {\n          reject(err);\n        } else if (success) {\n          resolve();\n        } else reject(new Error(\"some error occured\"));\n      };\n\n      handleStream(providerChangeStream, \"data\", handler);\n      const preopenInstanceId = getPreopenInstanceId();\n\n      this._handleWindow(preopenInstanceId, {\n        target: \"_blank\",\n        features: FEATURES_PROVIDER_CHANGE_WINDOW\n      });\n\n      providerChangeStream.write({\n        name: \"show_provider_change\",\n        data: {\n          network: _objectSpread({\n            host,\n            chainId,\n            networkName\n          }, rest),\n          preopenInstanceId,\n          override: false\n        }\n      });\n    });\n  }\n\n  showWallet(path) {\n    let params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const showWalletStream = this.communicationMux.getStream(\"show_wallet\");\n    const finalPath = path ? `/${path}` : \"\";\n    showWalletStream.write({\n      name: \"show_wallet\",\n      data: {\n        path: finalPath\n      }\n    });\n\n    const showWalletHandler = chunk => {\n      if (chunk.name === \"show_wallet_instance\") {\n        // Let the error propogate up (hence, no try catch)\n        const {\n          instanceId\n        } = chunk.data;\n        const finalUrl = new URL(`${this.torusUrl}/wallet${finalPath}`); // Using URL constructor to prevent js injection and allow parameter validation.!\n\n        finalUrl.searchParams.append(\"integrity\", \"true\");\n        finalUrl.searchParams.append(\"instanceId\", instanceId);\n        Object.keys(params).forEach(x => {\n          finalUrl.searchParams.append(x, params[x]);\n        });\n        finalUrl.hash = `#isCustomLogin=${this.isCustomLogin}`;\n        const walletWindow = new PopupHandler({\n          url: finalUrl,\n          features: FEATURES_DEFAULT_WALLET_WINDOW\n        });\n        walletWindow.open();\n      }\n    };\n\n    handleStream(showWalletStream, \"data\", showWalletHandler);\n  }\n\n  async getPublicAddress(_ref2) {\n    let {\n      verifier,\n      verifierId,\n      isExtended = false\n    } = _ref2;\n    if (!configuration.supportedVerifierList.includes(verifier) || !WALLET_OPENLOGIN_VERIFIER_MAP[verifier]) throw new Error(\"Unsupported verifier\");\n    const walletVerifier = verifier;\n    const openloginVerifier = WALLET_OPENLOGIN_VERIFIER_MAP[verifier];\n    const url = new URL(`https://api.tor.us/lookup/torus`);\n    url.searchParams.append(\"verifier\", openloginVerifier);\n    url.searchParams.append(\"verifierId\", verifierId);\n    url.searchParams.append(\"walletVerifier\", walletVerifier);\n    url.searchParams.append(\"network\", \"mainnet\");\n    url.searchParams.append(\"isExtended\", isExtended.toString());\n    return get(url.href, {\n      headers: {\n        \"Content-Type\": \"application/json; charset=utf-8\"\n      }\n    }, {\n      useAPIKey: true\n    });\n  }\n\n  getUserInfo(message) {\n    return new Promise((resolve, reject) => {\n      if (this.isLoggedIn) {\n        const userInfoAccessStream = this.communicationMux.getStream(\"user_info_access\");\n        userInfoAccessStream.write({\n          name: \"user_info_access_request\"\n        });\n\n        const userInfoAccessHandler = chunk => {\n          const {\n            name,\n            data: {\n              approved,\n              payload,\n              rejected,\n              newRequest\n            }\n          } = chunk;\n\n          if (name === \"user_info_access_response\") {\n            if (approved) {\n              resolve(payload);\n            } else if (rejected) {\n              reject(new Error(\"User rejected the request\"));\n            } else if (newRequest) {\n              const userInfoStream = this.communicationMux.getStream(\"user_info\");\n\n              const userInfoHandler = handlerChunk => {\n                if (handlerChunk.name === \"user_info_response\") {\n                  if (handlerChunk.data.approved) {\n                    resolve(handlerChunk.data.payload);\n                  } else {\n                    reject(new Error(\"User rejected the request\"));\n                  }\n                }\n              };\n\n              handleStream(userInfoStream, \"data\", userInfoHandler);\n              const preopenInstanceId = getPreopenInstanceId();\n\n              this._handleWindow(preopenInstanceId, {\n                target: \"_blank\",\n                features: FEATURES_PROVIDER_CHANGE_WINDOW\n              });\n\n              userInfoStream.write({\n                name: \"user_info_request\",\n                data: {\n                  message,\n                  preopenInstanceId\n                }\n              });\n            }\n          }\n        };\n\n        handleStream(userInfoAccessStream, \"data\", userInfoAccessHandler);\n      } else reject(new Error(\"User has not logged in yet\"));\n    });\n  }\n\n  initiateTopup(provider, params) {\n    return new Promise((resolve, reject) => {\n      if (this.isInitialized) {\n        const {\n          errors,\n          isValid\n        } = validatePaymentProvider(provider, params);\n\n        if (!isValid) {\n          reject(new Error(JSON.stringify(errors)));\n          return;\n        }\n\n        const topupStream = this.communicationMux.getStream(\"topup\");\n\n        const topupHandler = chunk => {\n          if (chunk.name === \"topup_response\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n          }\n        };\n\n        handleStream(topupStream, \"data\", topupHandler);\n        const preopenInstanceId = getPreopenInstanceId();\n\n        this._handleWindow(preopenInstanceId);\n\n        topupStream.write({\n          name: \"topup_request\",\n          data: {\n            provider,\n            params,\n            preopenInstanceId\n          }\n        });\n      } else reject(new Error(\"Torus is not initialized yet\"));\n    });\n  }\n\n  async loginWithPrivateKey(loginParams) {\n    const {\n      privateKey,\n      userInfo\n    } = loginParams;\n    return new Promise((resolve, reject) => {\n      if (this.isInitialized) {\n        if (Buffer.from(privateKey, \"hex\").length !== 32) {\n          reject(new Error(\"Invalid private key, Please provide a 32 byte valid secp25k1 private key\"));\n          return;\n        }\n\n        const loginPrivKeyStream = this.communicationMux.getStream(\"login_with_private_key\");\n\n        const loginHandler = chunk => {\n          if (chunk.name === \"login_with_private_key_response\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n          }\n        };\n\n        handleStream(loginPrivKeyStream, \"data\", loginHandler);\n        loginPrivKeyStream.write({\n          name: \"login_with_private_key_request\",\n          data: {\n            privateKey,\n            userInfo\n          }\n        });\n      } else reject(new Error(\"Torus is not initialized yet\"));\n    });\n  }\n\n  async showWalletConnectScanner() {\n    if (!this.useWalletConnect) throw new Error(\"Set `useWalletConnect` as true in init function options to use wallet connect scanner\");\n    return new Promise((resolve, reject) => {\n      if (this.isLoggedIn) {\n        const walletConnectStream = this.communicationMux.getStream(\"wallet_connect_stream\");\n\n        const walletConnectHandler = chunk => {\n          if (chunk.name === \"wallet_connect_stream_res\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n\n            this._displayIframe();\n          }\n        };\n\n        handleStream(walletConnectStream, \"data\", walletConnectHandler);\n        walletConnectStream.write({\n          name: \"wallet_connect_stream_req\"\n        });\n\n        this._displayIframe(true);\n      } else reject(new Error(\"User has not logged in yet\"));\n    });\n  }\n\n  _handleWindow(preopenInstanceId) {\n    let {\n      url,\n      target,\n      features\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (preopenInstanceId) {\n      const windowStream = this.communicationMux.getStream(\"window\");\n      const finalUrl = new URL(url || `${this.torusUrl}/redirect?preopenInstanceId=${preopenInstanceId}`);\n      if (finalUrl.hash) finalUrl.hash += `&isCustomLogin=${this.isCustomLogin}`;else finalUrl.hash = `#isCustomLogin=${this.isCustomLogin}`;\n      const handledWindow = new PopupHandler({\n        url: finalUrl,\n        target,\n        features\n      });\n      handledWindow.open();\n\n      if (!handledWindow.window) {\n        this._createPopupBlockAlert(preopenInstanceId, finalUrl.href);\n\n        return;\n      }\n\n      windowStream.write({\n        name: \"opened_window\",\n        data: {\n          preopenInstanceId\n        }\n      });\n\n      const closeHandler = _ref3 => {\n        let {\n          preopenInstanceId: receivedId,\n          close\n        } = _ref3;\n\n        if (receivedId === preopenInstanceId && close) {\n          handledWindow.close();\n          windowStream.removeListener(\"data\", closeHandler);\n        }\n      };\n\n      windowStream.on(\"data\", closeHandler);\n      handledWindow.once(\"close\", () => {\n        windowStream.write({\n          data: {\n            preopenInstanceId,\n            closed: true\n          }\n        });\n        windowStream.removeListener(\"data\", closeHandler);\n      });\n    }\n  }\n\n  _setEmbedWhiteLabel(element) {\n    // Set whitelabel\n    const {\n      theme\n    } = this.whiteLabel || {};\n\n    if (theme) {\n      const {\n        isDark = false,\n        colors = {}\n      } = theme;\n      if (isDark) element.classList.add(\"torus-dark\");\n      if (colors.torusBrand1) element.style.setProperty(\"--torus-brand-1\", colors.torusBrand1);\n      if (colors.torusGray2) element.style.setProperty(\"--torus-gray-2\", colors.torusGray2);\n    }\n  }\n\n  _getLogoUrl() {\n    var _this$whiteLabel, _this$whiteLabel$them;\n\n    let logoUrl = `${this.torusUrl}/images/torus_icon-blue.svg`;\n\n    if ((_this$whiteLabel = this.whiteLabel) !== null && _this$whiteLabel !== void 0 && (_this$whiteLabel$them = _this$whiteLabel.theme) !== null && _this$whiteLabel$them !== void 0 && _this$whiteLabel$them.isDark) {\n      var _this$whiteLabel2;\n\n      logoUrl = ((_this$whiteLabel2 = this.whiteLabel) === null || _this$whiteLabel2 === void 0 ? void 0 : _this$whiteLabel2.logoLight) || logoUrl;\n    } else {\n      var _this$whiteLabel3;\n\n      logoUrl = ((_this$whiteLabel3 = this.whiteLabel) === null || _this$whiteLabel3 === void 0 ? void 0 : _this$whiteLabel3.logoDark) || logoUrl;\n    }\n\n    return logoUrl;\n  }\n\n  _sendWidgetVisibilityStatus(status) {\n    const torusWidgetVisibilityStream = this.communicationMux.getStream(\"torus-widget-visibility\");\n    torusWidgetVisibilityStream.write({\n      data: status\n    });\n  }\n\n  _displayIframe() {\n    let isFull = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    const style = {};\n    const size = this.buttonSize + 14; // 15px padding\n    // set phase\n\n    if (!isFull) {\n      style.display = this.torusWidgetVisibility ? \"block\" : \"none\";\n      style.height = `${size}px`;\n      style.width = `${size}px`;\n\n      switch (this.buttonPosition) {\n        case BUTTON_POSITION.TOP_LEFT:\n          style.top = \"0px\";\n          style.left = \"0px\";\n          style.right = \"auto\";\n          style.bottom = \"auto\";\n          break;\n\n        case BUTTON_POSITION.TOP_RIGHT:\n          style.top = \"0px\";\n          style.right = \"0px\";\n          style.left = \"auto\";\n          style.bottom = \"auto\";\n          break;\n\n        case BUTTON_POSITION.BOTTOM_RIGHT:\n          style.bottom = \"0px\";\n          style.right = \"0px\";\n          style.top = \"auto\";\n          style.left = \"auto\";\n          break;\n\n        case BUTTON_POSITION.BOTTOM_LEFT:\n        default:\n          style.bottom = \"0px\";\n          style.left = \"0px\";\n          style.top = \"auto\";\n          style.right = \"auto\";\n          break;\n      }\n    } else {\n      style.display = \"block\";\n      style.width = \"100%\";\n      style.height = \"100%\";\n      style.top = \"0px\";\n      style.right = \"0px\";\n      style.left = \"0px\";\n      style.bottom = \"0px\";\n    }\n\n    Object.assign(this.torusIframe.style, style);\n    this.isIframeFullScreen = isFull;\n  }\n\n  _setupWeb3() {\n    log.info(\"setupWeb3 running\"); // setup background connection\n\n    const metamaskStream = new BasePostMessageStream({\n      name: \"embed_metamask\",\n      target: \"iframe_metamask\",\n      targetWindow: this.torusIframe.contentWindow,\n      targetOrigin: new URL(this.torusUrl).origin\n    }); // Due to compatibility reasons, we should not set up multiplexing on window.metamaskstream\n    // because the MetamaskInpageProvider also attempts to do so.\n    // We create another LocalMessageDuplexStream for communication between dapp <> iframe\n\n    const communicationStream = new BasePostMessageStream({\n      name: \"embed_comm\",\n      target: \"iframe_comm\",\n      targetWindow: this.torusIframe.contentWindow,\n      targetOrigin: new URL(this.torusUrl).origin\n    }); // Backward compatibility with Gotchi :)\n    // window.metamaskStream = this.communicationStream\n    // compose the inpage provider\n\n    const inpageProvider = new TorusInpageProvider(metamaskStream); // detect eth_requestAccounts and pipe to enable for now\n\n    const detectAccountRequestPrototypeModifier = m => {\n      const originalMethod = inpageProvider[m];\n\n      inpageProvider[m] = function providerFunc(method) {\n        if (method && method === \"eth_requestAccounts\") {\n          return inpageProvider.enable();\n        }\n\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        return originalMethod.apply(this, [method, ...args]);\n      };\n    };\n\n    detectAccountRequestPrototypeModifier(\"send\");\n    detectAccountRequestPrototypeModifier(\"sendAsync\");\n\n    inpageProvider.enable = () => {\n      return new Promise((resolve, reject) => {\n        // If user is already logged in, we assume they have given access to the website\n        inpageProvider.sendAsync({\n          jsonrpc: \"2.0\",\n          id: getPreopenInstanceId(),\n          method: \"eth_requestAccounts\",\n          params: []\n        }, (err, response) => {\n          const {\n            result: res\n          } = response || {};\n\n          if (err) {\n            setTimeout(() => {\n              reject(err);\n            }, 50);\n          } else if (Array.isArray(res) && res.length > 0) {\n            // If user is already rehydrated, resolve this\n            // else wait for something to be written to status stream\n            const handleLoginCb = () => {\n              if (this.requestedVerifier !== \"\" && this.currentVerifier !== this.requestedVerifier) {\n                const {\n                  requestedVerifier\n                } = this; // eslint-disable-next-line promise/no-promise-in-callback\n\n                this.logout() // eslint-disable-next-line promise/always-return\n                .then(_ => {\n                  this.requestedVerifier = requestedVerifier;\n\n                  this._showLoginPopup(true, resolve, reject);\n                }).catch(error => reject(error));\n              } else {\n                resolve(res);\n              }\n            };\n\n            if (this.isLoggedIn) {\n              handleLoginCb();\n            } else {\n              this.isLoginCallback = handleLoginCb;\n            }\n          } else {\n            // set up listener for login\n            this._showLoginPopup(true, resolve, reject);\n          }\n        });\n      });\n    };\n\n    inpageProvider.tryPreopenHandle = (payload, cb) => {\n      const _payload = payload;\n\n      if (!Array.isArray(_payload) && UNSAFE_METHODS.includes(_payload.method)) {\n        const preopenInstanceId = getPreopenInstanceId();\n\n        this._handleWindow(preopenInstanceId, {\n          target: \"_blank\",\n          features: FEATURES_CONFIRM_WINDOW\n        });\n\n        _payload.preopenInstanceId = preopenInstanceId;\n      }\n\n      inpageProvider._rpcEngine.handle(_payload, cb);\n    }; // Work around for web3@1.0 deleting the bound `sendAsync` but not the unbound\n    // `sendAsync` method on the prototype, causing `this` reference issues with drizzle\n\n\n    const proxiedInpageProvider = new Proxy(inpageProvider, {\n      // straight up lie that we deleted the property so that it doesnt\n      // throw an error in strict mode\n      deleteProperty: () => true\n    });\n    this.ethereum = proxiedInpageProvider;\n    const communicationMux = setupMultiplex(communicationStream);\n    this.communicationMux = communicationMux;\n    const windowStream = communicationMux.getStream(\"window\");\n    windowStream.on(\"data\", chunk => {\n      if (chunk.name === \"create_window\") {\n        // url is the url we need to open\n        // we can pass the final url upfront so that it removes the step of redirecting to /redirect and waiting for finalUrl\n        this._createPopupBlockAlert(chunk.data.preopenInstanceId, chunk.data.url);\n      }\n    }); // show torus widget if button clicked\n\n    const widgetStream = communicationMux.getStream(\"widget\");\n    widgetStream.on(\"data\", chunk => {\n      const {\n        data\n      } = chunk;\n\n      this._displayIframe(data);\n    }); // Show torus button if wallet has been hydrated/detected\n\n    const statusStream = communicationMux.getStream(\"status\");\n    statusStream.on(\"data\", status => {\n      // login\n      if (status.loggedIn) {\n        this.isLoggedIn = status.loggedIn;\n        this.currentVerifier = status.verifier;\n      } // logout\n      else this._displayIframe();\n\n      if (this.isLoginCallback) {\n        this.isLoginCallback();\n        delete this.isLoginCallback;\n      }\n    });\n    this.provider = proxiedInpageProvider;\n    if (this.provider.shouldSendMetadata) sendSiteMetadata(this.provider._rpcEngine);\n\n    inpageProvider._initializeState();\n\n    log.debug(\"Torus - injected provider\");\n  }\n\n  _showLoginPopup(calledFromEmbed, resolve, reject) {\n    const loginHandler = data => {\n      const {\n        err,\n        selectedAddress\n      } = data;\n\n      if (err) {\n        log.error(err);\n        if (reject) reject(err);\n      } // returns an array (cause accounts expects it)\n      else if (resolve) resolve([selectedAddress]);\n\n      if (this.isIframeFullScreen) this._displayIframe();\n    };\n\n    const oauthStream = this.communicationMux.getStream(\"oauth\");\n\n    if (!this.requestedVerifier) {\n      this._displayIframe(true);\n\n      handleStream(oauthStream, \"data\", loginHandler);\n      oauthStream.write({\n        name: \"oauth_modal\",\n        data: {\n          calledFromEmbed\n        }\n      });\n    } else {\n      handleStream(oauthStream, \"data\", loginHandler);\n      const preopenInstanceId = getPreopenInstanceId();\n\n      this._handleWindow(preopenInstanceId);\n\n      oauthStream.write({\n        name: \"oauth\",\n        data: {\n          calledFromEmbed,\n          verifier: this.requestedVerifier,\n          preopenInstanceId,\n          login_hint: this.loginHint\n        }\n      });\n    }\n  }\n\n  _createPopupBlockAlert(preopenInstanceId, url) {\n    const logoUrl = this._getLogoUrl();\n\n    const torusAlert = htmlToElement('<div id=\"torusAlert\" class=\"torus-alert--v2\">' + `<div id=\"torusAlert__logo\"><img src=\"${logoUrl}\" /></div>` + \"<div>\" + `<h1 id=\"torusAlert__title\">${this.embedTranslations.actionRequired}</h1>` + `<p id=\"torusAlert__desc\">${this.embedTranslations.pendingAction}</p>` + \"</div>\" + \"</div>\");\n    const successAlert = htmlToElement(`<div><a id=\"torusAlert__btn\">${this.embedTranslations.continue}</a></div>`);\n    const btnContainer = htmlToElement('<div id=\"torusAlert__btn-container\"></div>');\n    btnContainer.appendChild(successAlert);\n    torusAlert.appendChild(btnContainer);\n\n    const bindOnLoad = () => {\n      successAlert.addEventListener(\"click\", () => {\n        this._handleWindow(preopenInstanceId, {\n          url,\n          target: \"_blank\",\n          features: FEATURES_CONFIRM_WINDOW\n        });\n\n        torusAlert.remove();\n        if (this.torusAlertContainer.children.length === 0) this.torusAlertContainer.style.display = \"none\";\n      });\n    };\n\n    this._setEmbedWhiteLabel(torusAlert);\n\n    const attachOnLoad = () => {\n      this.torusAlertContainer.style.display = \"block\";\n      this.torusAlertContainer.appendChild(torusAlert);\n    };\n\n    runOnLoad(attachOnLoad);\n    runOnLoad(bindOnLoad);\n  }\n\n}\n\nexport { BUTTON_POSITION, LOGIN_PROVIDER, PAYMENT_PROVIDER, SUPPORTED_PAYMENT_NETWORK, TORUS_BUILD_ENV, TorusInpageProvider, WALLET_OPENLOGIN_VERIFIER_MAP, WALLET_VERIFIERS, Torus as default };\n//# sourceMappingURL=torus.esm.js.map\n",null,null,null,null,null,null,null,null,null,null,null,"var objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose.js\");\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nmodule.exports = _objectWithoutProperties, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nmodule.exports = _objectWithoutPropertiesLoose, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","export * from './asStream';\nexport * from './ComposedStore';\nexport * from './MergedStore';\nexport * from './ObservableStore';\nexport * from './transform';\n","import { Duplex as DuplexStream } from 'stream';\n\nimport { ObservableStore } from './ObservableStore';\n\nclass ObservableStoreStream<T> extends DuplexStream {\n  handler: (state: T) => void;\n\n  obsStore: ObservableStore<T>;\n\n  constructor(obsStore: ObservableStore<T>) {\n    super({\n      // pass values, not serializations\n      objectMode: true,\n    });\n    // dont buffer outgoing updates\n    this.resume();\n    // save handler so we can unsubscribe later\n    this.handler = (state: T) => this.push(state);\n    // subscribe to obsStore changes\n    this.obsStore = obsStore;\n    this.obsStore.subscribe(this.handler);\n  }\n\n  // emit current state on new destination\n  pipe<U extends NodeJS.WritableStream>(\n    dest: U,\n    options?: { end?: boolean },\n  ): U {\n    const result = super.pipe(dest, options);\n    dest.write(this.obsStore.getState() as any);\n    return result;\n  }\n\n  // write from incoming stream to state\n  _write(\n    chunk: any,\n    _encoding: string,\n    callback: (error?: Error | null) => void,\n  ): void {\n    this.obsStore.putState(chunk);\n    callback();\n  }\n\n  // noop - outgoing stream is asking us if we have data we arent giving it\n  _read(_size: number): void {\n    return undefined;\n  }\n\n  // unsubscribe from event emitter\n  _destroy(err: Error | null, callback: (error: Error | null) => void): void {\n    this.obsStore.unsubscribe(this.handler);\n    super._destroy(err, callback);\n  }\n}\n\nexport function storeAsStream<T>(\n  obsStore: ObservableStore<T>,\n): ObservableStoreStream<T> {\n  return new ObservableStoreStream(obsStore);\n}\n","import { ObservableStore } from './ObservableStore';\n\nexport class ComposedStore<\n  T extends Record<string, Record<string, unknown>>,\n> extends ObservableStore<T> {\n  private _children: Record<keyof T, ObservableStore<T[keyof T]>>;\n\n  constructor(children: Record<keyof T, ObservableStore<T[keyof T]>>) {\n    // Typecast: Preserve existing behavior\n    super({} as unknown as T);\n\n    // subscribe to children\n    this._children = children || {};\n    Object.keys(this._children).forEach((childKey) => {\n      const child = this._children[childKey];\n      this._addChild(childKey, child);\n    });\n  }\n\n  _addChild(childKey: keyof T, child: ObservableStore<T[keyof T]>) {\n    const updateFromChild = (childValue: T[keyof T]) => {\n      const state = this.getState();\n      state[childKey] = childValue;\n      this.putState(state);\n    };\n\n    child.subscribe(updateFromChild);\n    updateFromChild(child.getState());\n  }\n}\n","import { ObservableStore } from './ObservableStore';\n\nexport class MergedStore<\n  T extends Record<string, unknown>,\n> extends ObservableStore<T> {\n  private _children: ObservableStore<Partial<T>>[];\n\n  constructor(children = []) {\n    // Typecast: Preserve existing behavior\n    super({} as unknown as T);\n\n    this._children = children;\n    // subscribe to children\n    children.forEach((child) => this._addChild(child));\n    this._updateWholeState();\n  }\n\n  _addChild(child: ObservableStore<Partial<T>>): void {\n    child.subscribe(() => this._updateWholeState());\n  }\n\n  _updateWholeState(): void {\n    const childStates = this._children.map((child) => child.getState());\n    // apply shallow merge over states\n    const state = Object.assign({}, ...childStates);\n    this.putState(state);\n  }\n}\n","import { obj as TransformStream } from 'through2';\n\nexport function storeTransformStream<T, U>(syncTransformFn: (state: T) => U) {\n  return TransformStream((state, _encoding, cb) => {\n    try {\n      const newState = syncTransformFn(state);\n      cb(null, newState);\n      return undefined;\n    } catch (err) {\n      cb(err);\n      return undefined;\n    }\n  });\n}\n","var Transform = require('readable-stream').Transform\n  , inherits  = require('util').inherits\n  , xtend     = require('xtend')\n\nfunction DestroyableTransform(opts) {\n  Transform.call(this, opts)\n  this._destroyed = false\n}\n\ninherits(DestroyableTransform, Transform)\n\nDestroyableTransform.prototype.destroy = function(err) {\n  if (this._destroyed) return\n  this._destroyed = true\n  \n  var self = this\n  process.nextTick(function() {\n    if (err)\n      self.emit('error', err)\n    self.emit('close')\n  })\n}\n\n// a noop _transform function\nfunction noop (chunk, enc, callback) {\n  callback(null, chunk)\n}\n\n\n// create a new export function, used by both the main export and\n// the .ctor export, contains common logic for dealing with arguments\nfunction through2 (construct) {\n  return function (options, transform, flush) {\n    if (typeof options == 'function') {\n      flush     = transform\n      transform = options\n      options   = {}\n    }\n\n    if (typeof transform != 'function')\n      transform = noop\n\n    if (typeof flush != 'function')\n      flush = null\n\n    return construct(options, transform, flush)\n  }\n}\n\n\n// main export, just make me a transform stream!\nmodule.exports = through2(function (options, transform, flush) {\n  var t2 = new DestroyableTransform(options)\n\n  t2._transform = transform\n\n  if (flush)\n    t2._flush = flush\n\n  return t2\n})\n\n\n// make me a reusable prototype that I can `new`, or implicitly `new`\n// with a constructor call\nmodule.exports.ctor = through2(function (options, transform, flush) {\n  function Through2 (override) {\n    if (!(this instanceof Through2))\n      return new Through2(override)\n\n    this.options = xtend(options, override)\n\n    DestroyableTransform.call(this, this.options)\n  }\n\n  inherits(Through2, DestroyableTransform)\n\n  Through2.prototype._transform = transform\n\n  if (flush)\n    Through2.prototype._flush = flush\n\n  return Through2\n})\n\n\nmodule.exports.obj = through2(function (options, transform, flush) {\n  var t2 = new DestroyableTransform(xtend({ objectMode: true, highWaterMark: 16 }, options))\n\n  t2._transform = transform\n\n  if (flush)\n    t2._flush = flush\n\n  return t2\n})\n","import _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _get from '@babel/runtime/helpers/get';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport Torus from '@toruslabs/torus-embed';\nimport { WALLET_ADAPTERS, ADAPTER_NAMESPACES, CHAIN_NAMESPACES, ADAPTER_CATEGORY, ADAPTER_STATUS, log, ADAPTER_EVENTS, getChainConfig, Web3AuthError, WalletLoginError, WalletInitializationError } from '@web3auth/base';\nimport { BaseEvmAdapter } from '@web3auth/base-evm-adapter';\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar TorusWalletAdapter = /*#__PURE__*/function (_BaseEvmAdapter) {\n  _inherits(TorusWalletAdapter, _BaseEvmAdapter);\n\n  var _super = _createSuper(TorusWalletAdapter);\n\n  function TorusWalletAdapter(params) {\n    var _this;\n\n    _classCallCheck(this, TorusWalletAdapter);\n\n    _this = _super.call(this, params);\n\n    _defineProperty(_assertThisInitialized(_this), \"name\", WALLET_ADAPTERS.TORUS_EVM);\n\n    _defineProperty(_assertThisInitialized(_this), \"adapterNamespace\", ADAPTER_NAMESPACES.EIP155);\n\n    _defineProperty(_assertThisInitialized(_this), \"currentChainNamespace\", CHAIN_NAMESPACES.EIP155);\n\n    _defineProperty(_assertThisInitialized(_this), \"type\", ADAPTER_CATEGORY.EXTERNAL);\n\n    _defineProperty(_assertThisInitialized(_this), \"status\", ADAPTER_STATUS.NOT_READY);\n\n    _defineProperty(_assertThisInitialized(_this), \"torusInstance\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"torusWalletOptions\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"initParams\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"loginSettings\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"rehydrated\", false);\n\n    _this.torusWalletOptions = params.adapterSettings || {};\n    _this.initParams = params.initParams || {};\n    _this.loginSettings = params.loginSettings || {};\n    _this.chainConfig = params.chainConfig || null;\n    _this.sessionTime = params.sessionTime || 86400;\n    return _this;\n  }\n\n  _createClass(TorusWalletAdapter, [{\n    key: \"provider\",\n    get: function get() {\n      if (this.status === ADAPTER_STATUS.CONNECTED && this.torusInstance) {\n        return this.torusInstance.provider;\n      }\n\n      return null;\n    },\n    set: function set(_) {\n      throw new Error(\"Not implemented\");\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(options) {\n        var network, _this$chainConfig, blockExplorer, displayName, chainId, ticker, tickerName, _this$chainConfig2, _chainId2, _blockExplorer, _displayName, rpcTarget, _ticker, _tickerName;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _get(_getPrototypeOf(TorusWalletAdapter.prototype), \"checkInitializationRequirements\", this).call(this); // set chainConfig for mainnet by default if not set\n\n\n                if (!this.chainConfig) {\n                  this.chainConfig = getChainConfig(CHAIN_NAMESPACES.EIP155, 1);\n                  _this$chainConfig = this.chainConfig, blockExplorer = _this$chainConfig.blockExplorer, displayName = _this$chainConfig.displayName, chainId = _this$chainConfig.chainId, ticker = _this$chainConfig.ticker, tickerName = _this$chainConfig.tickerName;\n                  network = {\n                    chainId: Number.parseInt(chainId, 16),\n                    host: \"mainnet\",\n                    blockExplorer: blockExplorer,\n                    networkName: displayName,\n                    ticker: ticker,\n                    tickerName: tickerName\n                  };\n                } else {\n                  _this$chainConfig2 = this.chainConfig, _chainId2 = _this$chainConfig2.chainId, _blockExplorer = _this$chainConfig2.blockExplorer, _displayName = _this$chainConfig2.displayName, rpcTarget = _this$chainConfig2.rpcTarget, _ticker = _this$chainConfig2.ticker, _tickerName = _this$chainConfig2.tickerName;\n                  network = {\n                    chainId: Number.parseInt(_chainId2, 16),\n                    host: rpcTarget,\n                    blockExplorer: _blockExplorer,\n                    networkName: _displayName,\n                    ticker: _ticker,\n                    tickerName: _tickerName\n                  };\n                }\n\n                this.torusInstance = new Torus(this.torusWalletOptions);\n                log.debug(\"initializing torus evm adapter init\");\n                _context.next = 6;\n                return this.torusInstance.init(_objectSpread(_objectSpread({\n                  showTorusButton: false\n                }, this.initParams), {}, {\n                  network: network\n                }));\n\n              case 6:\n                this.status = ADAPTER_STATUS.READY;\n                this.emit(ADAPTER_EVENTS.READY, WALLET_ADAPTERS.TORUS_EVM);\n                _context.prev = 8;\n                log.debug(\"initializing torus evm adapter\");\n\n                if (!options.autoConnect) {\n                  _context.next = 14;\n                  break;\n                }\n\n                this.rehydrated = true;\n                _context.next = 14;\n                return this.connect();\n\n              case 14:\n                _context.next = 20;\n                break;\n\n              case 16:\n                _context.prev = 16;\n                _context.t0 = _context[\"catch\"](8);\n                log.error(\"Failed to connect with torus evm provider\", _context.t0);\n                this.emit(ADAPTER_EVENTS.ERRORED, _context.t0);\n\n              case 20:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[8, 16]]);\n      }));\n\n      function init(_x) {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }()\n  }, {\n    key: \"connect\",\n    value: function () {\n      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var chainId, _this$chainConfig3, _chainId, blockExplorer, displayName, rpcTarget, ticker, tickerName, network, updatedChainID;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _get(_getPrototypeOf(TorusWalletAdapter.prototype), \"checkConnectionRequirements\", this).call(this);\n\n                if (this.torusInstance) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                throw WalletInitializationError.notReady(\"Torus wallet is not initialized\");\n\n              case 3:\n                this.status = ADAPTER_STATUS.CONNECTING;\n                this.emit(ADAPTER_EVENTS.CONNECTING, {\n                  adapter: WALLET_ADAPTERS.TORUS_EVM\n                });\n                _context2.prev = 5;\n                _context2.next = 8;\n                return this.torusInstance.login(this.loginSettings);\n\n              case 8:\n                chainId = this.torusInstance.provider.chainId;\n\n                if (!(chainId && parseInt(chainId) !== parseInt(this.chainConfig.chainId, 16))) {\n                  _context2.next = 19;\n                  break;\n                }\n\n                _this$chainConfig3 = this.chainConfig, _chainId = _this$chainConfig3.chainId, blockExplorer = _this$chainConfig3.blockExplorer, displayName = _this$chainConfig3.displayName, rpcTarget = _this$chainConfig3.rpcTarget, ticker = _this$chainConfig3.ticker, tickerName = _this$chainConfig3.tickerName;\n                network = {\n                  chainId: Number.parseInt(_chainId, 16),\n                  host: rpcTarget,\n                  blockExplorer: blockExplorer,\n                  networkName: displayName,\n                  tickerName: tickerName,\n                  ticker: ticker\n                }; // in some cases when user manually switches chain and relogin then adapter will not connect to initially passed\n                // chainConfig but will connect to the one that user switched to.\n                // So here trying to switch network to the one that was initially passed in chainConfig.\n\n                _context2.next = 14;\n                return this.torusInstance.setProvider(_objectSpread({}, network));\n\n              case 14:\n                _context2.next = 16;\n                return this.torusInstance.ethereum.request({\n                  method: \"eth_chainId\"\n                });\n\n              case 16:\n                updatedChainID = _context2.sent;\n\n                if (!(updatedChainID && parseInt(updatedChainID) !== parseInt(this.chainConfig.chainId, 16))) {\n                  _context2.next = 19;\n                  break;\n                }\n\n                throw WalletInitializationError.fromCode(5000, \"Not connected to correct chainId. Expected: \".concat(this.chainConfig.chainId, \", Current: \").concat(updatedChainID));\n\n              case 19:\n                this.status = ADAPTER_STATUS.CONNECTED;\n                this.torusInstance.showTorusButton();\n                this.emit(ADAPTER_STATUS.CONNECTED, {\n                  adapter: WALLET_ADAPTERS.TORUS_EVM,\n                  reconnected: this.rehydrated\n                });\n                return _context2.abrupt(\"return\", this.provider);\n\n              case 25:\n                _context2.prev = 25;\n                _context2.t0 = _context2[\"catch\"](5);\n                // ready again to be connected\n                this.status = ADAPTER_STATUS.READY;\n                this.rehydrated = false;\n                this.emit(ADAPTER_STATUS.ERRORED, _context2.t0);\n                throw _context2.t0 instanceof Web3AuthError ? _context2.t0 : WalletLoginError.connectionError(\"Failed to login with torus wallet\");\n\n              case 31:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[5, 25]]);\n      }));\n\n      function connect() {\n        return _connect.apply(this, arguments);\n      }\n\n      return connect;\n    }()\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var options,\n            _args3 = arguments;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                options = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : {\n                  cleanup: false\n                };\n\n                if (this.torusInstance) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                throw WalletInitializationError.notReady(\"Torus wallet is not initialized\");\n\n              case 3:\n                _context3.next = 5;\n                return _get(_getPrototypeOf(TorusWalletAdapter.prototype), \"disconnect\", this).call(this);\n\n              case 5:\n                _context3.next = 7;\n                return this.torusInstance.logout();\n\n              case 7:\n                this.torusInstance.hideTorusButton();\n\n                if (options.cleanup) {\n                  this.status = ADAPTER_STATUS.NOT_READY;\n                  this.torusInstance = null;\n                } else {\n                  // ready to be connected again\n                  this.status = ADAPTER_STATUS.READY;\n                }\n\n                this.rehydrated = false;\n                this.emit(ADAPTER_EVENTS.DISCONNECTED);\n\n              case 11:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function disconnect() {\n        return _disconnect.apply(this, arguments);\n      }\n\n      return disconnect;\n    }()\n  }, {\n    key: \"getUserInfo\",\n    value: function () {\n      var _getUserInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var userInfo;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(this.status !== ADAPTER_STATUS.CONNECTED)) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                throw WalletLoginError.notConnectedError(\"Not connected with wallet\");\n\n              case 2:\n                if (this.torusInstance) {\n                  _context4.next = 4;\n                  break;\n                }\n\n                throw WalletInitializationError.notReady(\"Torus wallet is not initialized\");\n\n              case 4:\n                _context4.next = 6;\n                return this.torusInstance.getUserInfo(\"\");\n\n              case 6:\n                userInfo = _context4.sent;\n                return _context4.abrupt(\"return\", userInfo);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getUserInfo() {\n        return _getUserInfo.apply(this, arguments);\n      }\n\n      return getUserInfo;\n    }()\n  }, {\n    key: \"setAdapterSettings\",\n    value: function setAdapterSettings(options) {\n      if (this.status === ADAPTER_STATUS.READY) return;\n\n      if (options !== null && options !== void 0 && options.sessionTime) {\n        this.sessionTime = options.sessionTime;\n      }\n\n      if (options !== null && options !== void 0 && options.clientId) {\n        this.clientId = options.clientId;\n      }\n    }\n  }]);\n\n  return TorusWalletAdapter;\n}(BaseEvmAdapter);\n\nexport { TorusWalletAdapter };\n//# sourceMappingURL=torusEvmAdapter.esm.js.map\n"],"sourceRoot":""}